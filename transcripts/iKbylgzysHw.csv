start,end,text
480,6240," looks like we're live hello everyone and welcome to yet another recreational programming session"
6240,11360," with a mr azuzin let's make a little bit of announcement and officially start the stream"
11360,21440," uh so red circle live on twitch and what are we doing today on twitch.at television website today"
21440,27120," we're doing something interesting today we are implementing react and rust for terminals"
28880,34320," i'm going to give the link to twitch.tv/todding and i'm going to ping everyone who's interested in being"
34320,40800," pinged so i'm going to explain what all of that means in a second right so essentially today we"
40800,48000," continue working on for at which is the chat system right i wouldn't say chat application it's a chat"
48000,53520," system in in rust right so because it consists of the server and it consists of the client so it's a"
54480,59120," client service and circus clown architecture right so it's a circus clown architecture"
59120,68080," so and recently we developed a very simple client for this chat system so we used to use just telnet"
68080,75440," for simplicity but recently we implemented like an actual uh client using cross term which is the rust"
75440,81360," library for uh cross platform terminal stuff right so let me actually demonstrate you yeah let me actually"
81360,86880," demonstrate you so what you're supposed to do you're supposed to run the server first right so this is"
86880,95040," quite important so let's actually do the server uh right so let me actually grab the file path to the"
95040,102640," project so i can actually open that stuff in a separate terminal uh right so and let me uh actually"
102640,110160," copy paste the token so uh we're currently authorizing via the token that is generated by the server"
110160,114640," right so it is generated by the server so you basically give that token to the people you trust"
114640,120640," and they provide that token in a client when they are connecting so that's kind of the point uh right so"
120640,129600," let's actually start the client um so i'm gonna do cargo run bin client and here is the client so it's as you"
129600,135520," can see it's a 2e application text user interface application so it has commands uh right so one of"
135520,143760," the commands that you're supposed to use is supposed to use connect command uh you provide the um um the the"
143760,150560," ip in our case it's a local ip and then you provide the token uh right so i didn't have a token copy pasted"
150560,157840," anywhere so i i suppose what i need to do first i need to uh add that token to to the clipboard right so i'm"
157840,164880," going to do something like this um right i didn't have an x clip or i'm sorry i'm an idiot so it's"
164880,172080," actually talking so uh let's actually go to to the client right so and essentially i'm going to connect"
172080,177920," to 127.001 and i'm going to just copy paste like that and there we go we finally connected right we"
177920,182160," finally connected you're supposed to send messages and as you can see the server receives the messages"
182160,186800," if you connect another client you will be able to see the messages of other people and stuff like that so"
186800,194080," this is basically the chat application and it works great it works great on um you know real operating"
194080,202640," systems like linux unfortunately i've got some reports from the uh you know operating system for"
202640,209840," video games right so it's called something like doors or windows right so there is operating systems called"
209840,215840," for for gamers called windows and people reported that they have some sort of problems with this"
215840,222000," application which is kind of expected right so this is not a video game so obviously it is not going to"
222000,229200," work that well on the operating system for video games so that was quite expected so uh let's actually"
229200,236000," take a look at that so somebody actually tweeted that at me uh so let me let me see so here is the tweet"
236000,243360," it's going to be in the description right so unfortunately i can't access that tweet uh right so it is"
243360,251040," straight up banned in my country because twitter is a very dangerous website with propaganda so i i literally"
251040,257840," can't open that website unfortunately i can't open that website but through the magic of vpn i actually"
257840,264960," downloaded the video on that post so we still can watch that right so i'm going to show you so i think"
264960,271120," it's flickering yeah flickering mp4 so it's so here it is so that's the video that was uh reported to"
271120,276640," me so as you can see this is the operating system for video games right so this is the terminal obviously"
276640,284720," for video games uh and uh yeah so when they open this application it starts to flicker so apparently the"
284720,292080," operating system for video games doesn't have enough fps which is quite surprising to me right so"
292800,298000," like it's it's it's it's for video games so like you're supposed to have a lot of fps so there is"
298000,306400," also a another problem that uh some of them i can't catch the moment but uh sometimes the uh the keys"
306400,312640," that you press are pressed twice we already fixed that that's a bug of cross term so somebody submitted"
312640,320880," a pull request i accepted that so it's a known problem uh so but this is quite concerning"
322080,328480," this is quite concerning you know why because when i was implementing this client in one of the"
328480,336000," previous streams i even i think i even said that out loud i i said that i think cross term actually"
336000,344160," implements buffering right some sort of a buffering and by buffering i meant that it has this virtual"
344160,351040," terminal it maintains that virtual terminal every changes you make you make to that virtual terminal and then"
351040,357360," before flushing uh the state of the buffer it would actually uh compute the diff"
357360,366080," between the frames and only apply the changes where they're needed so and i even compare that to a"
366080,372320," virtual dome of react right you do you guys know about virtual dome of react it's kind of a similar"
372320,380160," concept right so basically react maintains its own like a virtual copy of the dome of the browser and uh instead"
380160,386880," of applying the changes to the real dome right away it basically accumulates the changes finds the diff and"
386880,395360," finds the way to sort of like apply only the things that changed those greatly uh allegedly um improving"
395360,396080," the performance"
396080,404560," it's been proven several times but that that's not the case but nobody cares i think it is the case for"
404560,413040," for for facebook right i think as far as i know it is the case for facebook because their website the dome"
413040,419040," of their website is so clusterfuck over complicated that they need these kind of solutions to actually"
419040,428960," improve the performance so yeah that actually supports the thesis that um react was developed by facebook for"
428960,437200," for themselves not for you right if you think facebook develops react for you you're completely wrong they"
437200,439200," develop in react for for themselves"
439200,448960," so anyway and essentially what we're going to be doing today we're going to be implementing virtual dome"
449760,458240," in rust for terminal because apparently cross term doesn't support that i looked around i googled around"
458240,465840," and apparently cross term is considered the low level library it is a low level library and because of"
465840,473920," that it's not the concern of such a low level library it's for the high level peasants to think about that"
474400,482000," buffering so and because of that we are the one we are the peasants who's going to be implemented that"
482000,487920," uh freaking buffering so luckily it's not that difficult you literally just maintain a 2d array"
487920,495520," and instead of rendering directly into the terminal you render into that 2d array and then you just find"
495520,502880," the difference luckily it's not a tree it's not a dome finding the difference between two-dimensional arrays"
502880,510240," it's super easy and then basically we can form some sort of a patch and we can apply that patch"
510240,514960," through the cross term commands if that makes any sense i think it would make more sense"
514960,521120," when we actually start writing the code uh right so i think that's a pretty interesting topic"
521120,531120," so yeah all right let's go ahead and do that let's go ahead and do that so uh i think i need to close"
531120,539120," everything in here it should be pretty step forward i hope so at least uh i hope so at least so i'm gonna"
539120,549920," go into the client and uh so as of right now we're sort of like a maintaining uh immediate ui style uh you"
549920,556720," know rendering so for instance i have a client and i have a chat and it has a method to render right so and"
556720,564960," essentially in that method to render right we provide the cueable command basically the terminal so this"
564960,570880," is the terminal and the boundary within which we have to render everything and we just render everything"
570880,579840," within that uh within that boundary um right so but what that means is that we need to get to read of this"
579840,586240," direct access to the terminal right so as you can see we um accessing the terminal directly and we're"
586240,592640," issuing commands to the terminal directly so we need to put some sort of like a middle man between the"
592640,600720," rendering code and the actual terminal so what we can do we can introduce some sort of a buffer right so we"
600720,609200," can introduce some sort of a buffer and uh the buffer could be like um a two-dimensional array of characters"
609200,616640," right so some sort of like a cells uh right and obviously that buffer is going to own uh those cells"
616640,622640," right so let's actually make them characters but here's the interesting thing in rust you can't quite"
622640,632400," easily make two-dimensional arrays in a fortran style right in a fortran style specifically right"
632400,639600," so i'm being very careful with my words uh just to not let the people in the chat say oh you can actually"
639600,649520," do vector of vector this is a not fortran style this is a not first and style uh essentially fortran"
649520,655920," style two-dimensional arrays and also three-dimensional let's say multi-dimensional arrays actually"
655920,663520," continues in the memory they actually completely continues in the memory i think c also supports this"
663520,668160," kind of style of arrays but they are kind of they kind of organize differently i think fortran"
668160,673120," organizes them differently so essentially c arrays if we're talking about two-dimensional arrays are"
673120,677760," row-wise arrays and fortran are column-wise arrays right so there are some reasons for doing that but"
677760,684720," anyway so these kind of style of arrays are really difficult in uh in rust right they're really difficult"
684720,690720," in rust so the best thing you can do is just have a one-dimensional array and also store width and"
690720,697360," height and basically compute the shape of the array uh yourself right so we also need to keep track of the"
697360,703280," width and height um so if you do just vector of vector it's not going to be continuous in the"
703280,707120," memory the rows of the array are going to be continuous in the memory right but between the"
707120,711680," rows there should there will be some gaps and stuff like that maybe they're going to be in different"
711680,716560," places remember uh right well they're definitely going to be in different places in memory because"
716560,722800," they're going to be allocated at different times uh also quite heavily depends on the allocator but i mean"
722800,727840," who cares uh it doesn't really matter because we're not going to be doing that anyway uh so and as far"
727840,734080," as i know you can't just do shit like that in rust right so you can't group several variables together"
734080,739760," because fuck you this is rust so this is how you're supposed to do this kind of thing so and that's"
739760,748880," basically the buffer right so that's basically the buffer so and interestingly interestingly um what"
748880,756400," we can do so yeah some people say you can do things like that but this is a static array right so we need"
756400,762400," dynamic arrays right we need dynamic arrays so and i'm pretty sure you can come up with some sort of a"
762400,769200," cluster effects fox solution to support dynamic arrays but who cares let's just have a continuous"
769200,776720," thing in the memory right so that thing works uh right i know you guys like to you know um you know"
776720,782720," rattle about like little and important cosmetic details on how to organize a race in the memory but"
782720,790560," like we just need some data in the memory okay calm down right it doesn't fucking matter so um anyway"
790560,798720," so we have a buffer in here so we have a buffer in here and uh i suppose instead of like providing the"
798720,805280," uh the usual interface that cross term provides to us we could provide our own interface we could just"
805280,814160," like have something like uh put right so and this is going to be mutable self and in here we could provide"
814160,821360," the uh the uh the coordinates use size uh use size and uh the character that you want to put in here right"
821360,828240," so the character that you want to put in here so interestingly enough uh if you take a look at this"
828240,837600," carefully we also have this style we also have like a different style of colors and stuff like that uh right so"
837600,845840," maybe we should also keep track of that so maybe each individual cell is not just a character right"
845840,853120," it's not just a character it's also the color but it's also foreground color and background color so we"
853120,858880," kind of need to take that into account as well so let's actually introduce maybe cell or something like"
858880,870800," that and uh so maybe it's going to be character maybe ch so this is the character and um so fg color and bg"
870800,876880," color so as far as i know we already have a color imported from somewhere right so here is the color and"
877440,888000," basically we have the of this two-dimensional array uh of these cells right so in here we can uh specify"
888000,895360," maybe i think it makes sense to just accept the cell right so just let's just accept the cell um and"
895360,904000," that should be it basically that should be it but not really right so here we're putting like a"
904960,908480," single character right we're putting a single character we're putting a single character"
908480,917760," put cell but quite often one of the things i may want to do i want to be able to put an entire string"
917760,925440," right so uh put str and putting str is basically going to be um"
928240,936560," you know doing several like put cell several times right put cell several times so uh let's actually do"
936560,944240," it like that so we can put it somewhere like here u size y u size um but since we're operating on the"
944240,953680," level of characters maybe we're gonna accept uh you know a slice of these characters right and then uh"
953680,958720," foreground and background colors for for all of these characters right because we're if we're putting like"
958720,965360," a chunk right so if we're putting like a chunk um we want them to be of the same style basically right"
965360,971440," so we want them to be of the same style i think um so uh let's put it like this so this is going to be"
971440,981120," color and uh this is going to be color like that but since it's not um a string anymore right so should i say"
981120,989760," cells right so but then it's a i don't know so maybe maybe cells is a good name so they're like i don't"
989760,996880," really like this kind of names when they differ with just s but we're talking about uh you know statically"
996880,1003360," typed language right so very strong very strict statically type language so if i provide incorrect"
1003360,1007760," arguments in here it's just like it's gonna complain about that so that's fine"
1007760,1020240," that should be totally fine um all right so maybe i'm gonna continue in the same style so essentially"
1021920,1028880," this is going to be like a character and yeah i'm gonna just continue like that"
1028880,1040640," okay uh so what we want to do in here we want to basically compute uh the cell and set"
1040640,1048400," the you know ch there right so we want to set ch in there so one of the things we can do we can try to"
1048400,1054480," get it uh right so we're going to think about the cells row wise right so essentially we're going to"
1054480,1061360," have like a two-dimensional array so here's the row uh maybe i'm going to have more of them uh right like"
1061360,1067520," this but in the memory we're going to store all of that um linearly right we're going to start all of"
1067520,1077600," that linearly so that means y determines the uh the current row right so we have to multiply y by the"
1077600,1086800," width of the of the buffer right so essentially we need to find the second row right so that means we"
1086800,1097440," have to take zero uh and uh multiply uh this size by two right and that means we're going to get to"
1097440,1102480," to this row right so we're going to get to this row because if you multiply by two you basically shift"
1102480,1109600," by the size of the width right and then we're upset by offset by x so uh get if i remember correctly we'll"
1109600,1115360," return sum so maybe we want to actually get a mutable one right so we want to get a mutable one"
1115360,1124800," so if let uh sum and we've got a cell so here's the thing so maybe i'm going to still want to call it ch"
1124800,1131920," because then later it will make it easier to do something like this uh where i can just do ch fg bg"
1132560,1140400," and effectively i just set that specific cell and if uh x and y are out of bounds nothing is going to"
1140400,1147120," happen right it's going to just basically silently ignore this entire stuff hopefully uh hopefully it's"
1147120,1154400," going to silently ignore this entire stuff so interestingly interestingly interestingly"
1159760,1171840," so um we can basically do the following thing we can find uh the sort of like a flat index of um of"
1171840,1180160," these coordinates and we can just move forward and put characters if we reach the right side just because"
1180160,1186640," we're following in a straight row we can just wrap around uh which is kind of similar to how the actual"
1186640,1192480," terminal behaves right it's it's actually similar to how actual terminal behaves so that should be fine"
1192480,1200720," so let's actually find this flat uh flat index right so this is going to be uh y multiplied by self uh"
1200720,1208320," width plus x right so here is the flat index and essentially maybe i'm going to do the following thing"
1208320,1215200," right so this is going to be mute and what we want to do while index is less than the"
1215200,1221920," um size of the cells i suppose right so this is the count but we also need to simultaneously move"
1221920,1228960," along the cells in here too right so which kind of makes it a little bit painful right so it kind of"
1228960,1234640," makes it a little bit painful but not that much to be fair right so we can take the cells we can start"
1234640,1241920," iterating them and we can start enumerating them uh right so and let's actually call them ch right so for the"
1241920,1248240," consistency uh with with the previous thing in here right so with the consistency with the previous thing"
1248240,1255840," in here so and uh let's do the following thing so this is the chs ch in uh and of course we're"
1255840,1262240," enumerating this entire stuff so that means we need to have something like this so uh that should be"
1262240,1272080," fine that should be fine so if index plus that specific of set is greater than the uh size of the buffer uh"
1272080,1278160," that means we're kind of done doing this entire thing so we might as well break out of that otherwise"
1278160,1287040," otherwise what we have to do is um just you know self put uh put cell uh something like"
1288160,1295600," uh to be fair we already kind of got uh the flat index right so we already kind of got the flat index so"
1295600,1302560," that means uh what we want to do we want to we want to just like do this right away in right away in here"
1303360,1306000," so if let um"
1306000,1318000," some uh cell and let's just reassign this entire stuff back in here right basically"
1318000,1324080," basically basically basically basically so i think this is the two operations that we'll need in here"
1324080,1329280," right so this is the only two operations that we'll need in here another operation that we'll probably need"
1329280,1336640," is an ability to calculate the div between the buffers that's for sure um right but uh we'll do"
1336640,1341680," that a little bit later so let me try to compile this entire thing and see uh if it's going to complain"
1341680,1347520," it's definitely going to complain uh okay so this is not a buffer this is called cells right so"
1347520,1355520," so what else do we have in here cells count is unknown oh because it's len right okay so that's"
1355520,1362720," that's totally fine and yeah so this is a huge problem in here because ch is a pointer right so"
1362720,1368400," can i can you just like do something like this and automatically dereference apparently i can look at"
1368400,1375680," that so that makes it a little bit easier right so if i have to dereference it like that in here"
1375680,1381200," that means i have to put a little bit of an extra syntactical noise like this and i don't really want to"
1381200,1386480," do that right so it's better to like pattern match it like this and it just looks nice more or less"
1386480,1398800," hopefully okay so we have a buffer right so we have a buffer and uh so yeah we need to um"
1398800,1411040," modify everything that uses std out to use that specific buffer um so especially when we're talking about"
1411200,1423760," the chat when we're talking about the chat so i'm just thinking how can we approach this entire stuff"
1423760,1432720," um so we need a way to construct that specific buffer as well right we need a way to construct the specific"
1432720,1441360," buffer so maybe we can say like a new where you have to provide uh width and height and we can pre-allocate"
1441360,1449280," uh this entire buffer for you right so that would make sense i think i think that would make sense"
1450320,1459520," um so we can basically create the cells right so we can create the cells but then we need to kind of"
1459520,1468400," resize them uh as far as i know you can just do something like this right so i'm pretty sure so there"
1468400,1477200," there was a back uh so rust up doc there was a back macro that allows you to just construct those things"
1478720,1485280," uh chromium okay so in in the latest versions of chromium i think they're they introduce some sort"
1485280,1491680," of a delay when you type and search for something right so for example if i search for the rust there"
1491680,1497200," is a little bit of a delay and it's a little bit annoying i don't remember that delay in the older"
1497200,1505520," versions of chromium it's like an extra delay and like why they introduce that it's just like i don't"
1505520,1510640," know so maybe it's just generally becoming slower maybe it's just generally becoming slow it's kind of dumb"
1510640,1518400," honestly um okay so there's two versions of vec right so the one that uh you know accepts just"
1518400,1524960," the sequence of expressions which are items and the one that accepts the element and the amount of things"
1524960,1531120," right so and essentially here we want to say that uh we want to have width by height of those things"
1532080,1537840," uh and uh what's going to be the cells right what's going to be the cells cells do we even have default"
1537840,1545840," cells maybe maybe we can specify the default cells um right so and this is actually a very interesting"
1545840,1555520," thing so can we do something like maybe we could have like a space yeah that's a very interesting idea"
1555520,1564560," just like have a space in here and then we can have implementation cell uh space right so this one is"
1564560,1574720," just self and if we do that ch is going to be just uh just this uh color uh look foreground color is going"
1574720,1580640," to be probably black um it's a foreground it has to be white it's definitely has to be white"
1580640,1587520," and background has to be black right so this is the terminal essential uh i don't quite remember"
1588320,1594000," is this how you do it no it's you actually capitalize it slightly differently that's how you capitalize it"
1594000,1601520," so this is just like a default space and uh we've got the cells in here right so afterwards uh we"
1601520,1607280," probably want to just return cells uh width and heights right so we just pre-located everything"
1607280,1612960," and we don't even have to make this mutable right we don't even have to make this mutable i'm"
1612960,1618560," not sure if it's going to compile or not right so maybe this thing must be clonable if we want to"
1618560,1623360," initialize it like that we'll see we'll see the the compiler is going to tell me right so what do"
1623360,1629760," happen here expected to size but got uh so do you want me to have a semicolon here i think it wants me"
1629760,1638960," to have a semicolon all right so expected to size uh that's really yeah so the element comes first and"
1638960,1645760," separate it with semicolon so i want to actually double check that it is in fact the case and uh"
1645760,1652720," okay as i said it has to be clonable right which is not that big of a deal all right so it is okay for"
1652720,1660240," that specific type to be clonable uh right so let's make it clonable okay everything seems to be working"
1660240,1666240," everything seems to be working but what's funny is that uh we also need to be able we also need to be"
1666240,1671600," able to resize the buffer because the terminal is going to be resizing right so there is one"
1671600,1677760," of the events that we're handling here which is a resize and we're handling it for a reason specifically"
1677760,1683680," to do this kind of stuff in here right as soon as the terminal resize we need to resize reallocate the"
1683680,1691840," buffer as well uh right so let's actually introduce something like resize and uh but i mean we can just"
1691840,1698720," create a new one um but maybe maybe not maybe it's more efficient to resize the thing does the vector"
1698720,1705040," have some sort of like a resize method can i do resize uh yes yes yes"
1705040,1714160," resize new length and uh you also provide the value and value is needed when the new length is bigger"
1714160,1719760," right so if new len is greater than n then the vec is extended by the difference with each addition"
1719760,1726240," slot filled with value okay so you provide the additional value to fill it with uh okay so let's"
1726240,1733280," actually take the mutable self and all of the parameters in here right so width and that thing"
1733280,1737520," so let's literally copy paste this stuff in here we're not going to return anything in here"
1737520,1742800," and we're going to take the cells i'm going to straight up resize them like so uh all right but"
1742800,1748320," the value we're going to fill everything with is going to be uh the space value and of course we should"
1748320,1756320," not forget to uh you know reassign the width in here right so there we go so that's how we resize the buffer"
1757440,1772800," that's how we resize the buffer okay good um so it does in fact compile right so uh i need to double"
1772800,1781280," check here it doesn't like okay so this is where we create the standard output let's create the buffer"
1781280,1786160," right so this is going to be the buffer and this is going to be the new buffer though we need to provide"
1786160,1792400," the size to actually create the buffer luckily we do have already size we do have already size and"
1792400,1800000," it's this one right so we know the size of the terminal and we can allocate it right away and this"
1800000,1806800," is actually kind of cool so after we resized uh after we handled the resize we can also resize the"
1806800,1814880," the buffer right so we can just provide like that okay that's pretty cool actually it's kind of cool that"
1814880,1824480," it fits perfectly in here um so yeah all right so okay so there's some problems in here because uh"
1824480,1831920," these things are use 16 so we need to cast them to use size of course because it's rust it do be anal"
1831920,1838320," like that sometimes not not sometimes actually every time right it is always anal and that's why i like"
1838320,1851840," it's got you hyper uh so there we go uh so i think we need to try to factor out everything uh factor out"
1851840,1858640," everything and start rendering into the buffer instead of the uh standard output right so where do we use the"
1858640,1865920," standard output okay so here we clean everything uh maybe we should not clean everything anymore so yeah this is"
1865920,1870720," basically what probably uh causes the flickering right this is probably what causes the flickering and"
1870720,1876400," we don't really want to do that uh we don't really want to do that so here we are rendering the status"
1876400,1885440," bar right so we're rendering the status bar so let's go ahead and try to replace qc with the buffer right"
1885440,1893520," so we're now accepting a mutable buffer and let's see what we can do in here uh let's see what we can do in here"
1893520,1898000," so i'm going to start at the compilation stuff uh right so and i'm going to go to the compilation errors"
1898000,1907600," so in here i'm moving specifically to x and y uh all right then i set the background and foreground and i"
1907600,1917760," print the label okay so essentially this is a single put cells command in fact right moving to specific"
1917760,1924560," coordinates setting background and foreground and then printing a bunch of things this is a straight"
1924560,1934080," up a buffer uh put cells like a single put cells actually these four commands which is actually kind"
1934080,1940240," of cool right so it makes it sort of like simpler in a sense uh right because you don't have to do it"
1940240,1947040," like that anymore uh so we can provide x and y right so we don't even have to cast it to use 16"
1947040,1951760," anymore because it's already use size that's pretty cool right so we don't have to do that"
1951760,1956720," the only problem that we have in here is that we have to convert it to characters right so that"
1956720,1962080," means we'll have to re-encode it a little bit um which is not that big of a deal i wonder"
1962720,1970320," it would be kind of cool if there was like an easy way to just you know convert a slice of str to a"
1970320,1978240," slice of character without recollecting everything like obviously i can uh you know iterate and maybe"
1978240,1987280," collect um yeah i have to do charts right so that gives me the characters and then to get the you know"
1987280,1994240," slice of this and i think i'll have to collect that into some sort of vector right into some sort of"
1994240,2000240," vector and uh i obviously don't want to keep that vector for very long so it's going to be a reference"
2000240,2008080," to a like a temporary object right so which looks freaking ugly like anything in rust so just exactly"
2010000,2020800," um all right so and uh we have foreground in here so fg so the background is supposed to be white so"
2020800,2026960," that means this one is supposed to be black right so this is black uh foreground and background is"
2026960,2031520," supposed to be white so that's what we'll put in here right like this and that should replace like"
2031520,2039760," this entire thing in here right and that should replace this entire thing so and afterwards uh afterwards"
2040000,2049440," um so this one is really convenient uh in a sense that we basically"
2049440,2060880," yeah we keep moving afterwards we keep moving afterwards so it's when we're rendering the status bar"
2060880,2068880," right so we're rendering the status bar we just render the label and then we fill everything with uh these"
2068880,2076720," spaces until the end right and because of the how the cursor behaves in the terminal it is actually"
2076720,2084240," super easy to do it like this so yeah but now we have to be super precise about that and to be super precise"
2084240,2091200," about that we have to know the characters of this thing to compute everything perfectly so maybe"
2093120,2100640," i'm gonna factor this thing out to separate variable even though i didn't want to do that uh right so"
2100640,2105680," even though i didn't want to do that so this is going to be labeled charts and maybe i'm going to say"
2105680,2111280," that this thing is going to be a vector so i don't have to provide the vector in here right it's going to"
2111280,2115920," infer all of that stuff automatically for me and because of that this thing becomes a little bit simpler"
2117360,2127920," uh it becomes a little bit simpler all right and uh now so what are we doing here we are iterating from 0 to"
2127920,2141840," w as u size but minus uh label right and w why do we cast w to u size if it is already to in u size"
2143760,2148160," why the fuck was i doing that well i mean i kind of know why the fuck i was doing that because"
2148160,2155440," i probably at some point maybe it was u16 and i just copy pasted that code which is totally fine"
2155440,2162560," which is totally fine so sometimes code evolves changes over time and it gets kind of weird so that's normal"
2162560,2169120," all right so we don't really need to do that anymore all right so we don't really need to do that"
2169120,2179840," anymore but interestingly since we kind of plan to um sort of have yeah it would be better to maybe"
2179840,2195600," have this as another x right so this is going to be x iterating from uh here up until the w right up until"
2195600,2205520," the w so then it is easier for us to put a single cell right put a single cell at x and y and x overshadows"
2205520,2212320," that specific x but y is that y which is super convenient in this specific case right in here we"
2212320,2219600," put a single space and we use the same sort of style for the characters thus yeah"
2221760,2228240," i really like that that is pretty cool isn't it i think that is pretty cool"
2228240,2235360," uh all right so let's actually try to recompile this entire thing and what does it say"
2235360,2241440," uh right so we don't have to do that anymore and so there's some warnings but is there any errors yeah"
2241440,2247360," there are some errors i can see that so yeah so here we're passing the std out right so we're passing"
2247360,2255600," std out and uh instead of passing the std out we have to provide the buffer like so uh so any errors"
2255600,2257360," i think there are some errors yeah there we go"
2257360,2271360," uh that's really oh okay so we did that status ah okay that is very cool so we use status bar three times"
2271360,2277200," actually uh right for the for the top thing and for the bottom thing and also depending on the bottom"
2277200,2283760," thing whether it's online or offline uh we just render different text right so as you can see uh yeah"
2283760,2291680," so we do it like that okay so that makes sense so we're now rendering this entire thing into a separate"
2291680,2297520," buffer right so we're rendering this entire thing into a separate buffer it will be kind of interesting to see"
2297520,2308560," how exactly it looks like after rendering everything into a separate buffer so we could have basically um"
2308560,2319360," you know break broken out of the loop right so we have um sort of like an event loop here so we do one"
2319360,2327360," iteration we do one iteration we break out of the loop uh and maybe it makes sense to actually reset"
2327360,2338320," the row mode afterwards right so we reset the row mode and uh let's go ahead and do that like so"
2338320,2346960," and try to print the state of the buffer in fact we can just go ahead and try to print it in debug mode"
2346960,2352000," like so just to see what's inside of the buffer right it's going to be garbage but i still want to see"
2352000,2357520," that you know what i'm talking about i still want to see that so let's try to compile this entire thing"
2357520,2365600," and uh so it's not really printable isn't it right so this is going to be struct buffer uh let's make it"
2365600,2372640," printable so we're going to derive debug and let's go ahead and try to compile that so it still complains"
2372640,2379280," because this is because cells are not debuggable let's also make them debuggable uh right so they"
2379280,2386640," are debuggable now and a boom yes so now let's try to run uh this entire thing so it's going to be bin"
2386640,2395520," client uh and that's a lot of things that's way too many things uh and i don't really like that um so okay"
2396160,2404560," we can try to maybe to maybe iterate through all of the cells in the buffer right so we could have buffer"
2404560,2417920," cells and uh so let's take a cell and maybe let's print only the cells that are not spaces right so we can"
2417920,2426400," say if cell uh ch not equal space just bring that specifically right because we know that majority of"
2426400,2431680," them is going to be spaces anyway uh we're interested in those that are not spaces right so this is going"
2431680,2440320," to be ch like so uh and uh let's go ahead and do that so that does not compile properly um so we cannot ch"
2440320,2447520," in that scope uh all right so we can say ch well i mean let's print the entire cell right let's print the"
2447520,2460320," entire cell uh okay so what was it complaining about uh so attempt to subtract with overflow"
2461200,2466880," i didn't expect that to happen oh this is because the height was too small"
2466880,2474160," yeah we should not run it within emacs because emacs is not particularly great uh terminal emulator"
2474160,2478000," especially in the compilation mode yeah so in compilation i don't think you can have interactive"
2478000,2484560," applications so that that's fair that is actually fair so this is going to be in client so let's actually"
2484560,2495760," see okay so we'll get some uh which is funny right so yeah we have for at for at and then start okay so"
2495760,2502160," but it actually printed them in a very scaved manner right i don't really know why uh right even though"
2502160,2509360," i asked it to reset uh everything in here so that's kind of that's kind of funny uh that is actually kind"
2509360,2517440," of funny what if we don't flush this entire thing i think flushing like ruins the terminal so let's"
2517440,2523360," actually not do that uh yeah let's do what but i mean you can already kind of see so here is for"
2523360,2534000," a t uh then s t a which is status offline right so this has the cells right so these are the cells"
2534000,2540400," that's actually pretty interesting okay so we kind of can see the contents of that buffer right so and"
2540400,2544800," i think that's quite important to know that something is happening in there oh yeah i see what"
2544800,2550560," the fuck is going on okay so i enable the raw mode what is supposed to do i suppose to disable it i think"
2550560,2559040," uh right so i suppose to disable it so maybe disabling it actually is going to help uh and make"
2559040,2567440," it a little bit better yeah there we go so as you can see for at status offline and this is exactly"
2567440,2574160," what we saw at the bottom in uh of the application right so essentially we just captured those those"
2574160,2580640," things uh we just captured those things so we can even see maybe coordinates of each individual thing"
2580640,2585440," but we'll have to recover those coordinates so one of the things we can do obviously we can enumerate"
2586160,2591920," uh this entire stuff right so we can enumerate and there we go we've got a flat index uh right"
2591920,2597200," but to be able to use that flat index we'll need to convert it to to the thing so y is actually quite"
2597200,2607360," easy you just take uh index and divide it by the buffer width and you get the y and x is going to be the"
2607360,2616240," same but mode of the buffer width uh right so we can get x and y and it's actually rather easy uh to"
2616240,2622800," just do something like this right and see at what coordinates you have all that stuff in there so it"
2622800,2628960," didn't like enumerate because we're not actually enumerating anything uh right so let's rebuild this one"
2628960,2637440," more time and if i try to run that so here are the coordinates so this one at the column uh at the"
2637440,2644240," column zero zero and the next one is the column 22 right so the the one is at the bottom and another"
2644240,2648880," one at the top and another one it's at the bottom so we can clearly see their coordinates so that's"
2648880,2656240," actually pretty cool that is actually pretty epic minor friend and we can see foreground black background"
2656240,2668160," white blah blah blah as usual as freaking usual okay so that is pretty poggers in my opinion um so we"
2668160,2673440," don't really need that stuff anymore all right so we don't really need that stuff anymore uh and"
2673440,2680320," obviously let's actually flush again so that was the status right so that was the status that was easy"
2680320,2687760," now rendering the chat rendering the chat itself by the way maybe i should not actually remove that code"
2687760,2697760," um you know what you know what i think i should have uh yeah i should have kept it right so because i"
2697760,2703760," think it's going to be useful in the future as we continue basically migrate the code to uh to a new way"
2703760,2710320," of rendering things right so by the way buffer the this buffer thing is basically the virtual dome but"
2710320,2718720," it's more like a virtual buffer right so it's like a virtual buffer it's like a virtual dome um so okay uh"
2718720,2725760," client f render so instead of accepting this thing we have to accept the buffer and let's see how it is going to"
2725760,2735200," go um so oh and we're actually rendering yes so the chat log needs needs to render things with different"
2735200,2739280," colors by the way it needs to render things with different colors but we do support colors in the"
2739280,2745200," buffer so that's totally fine uh okay so here we have a buffer let's go to the compilation errors"
2745200,2755600," boom where are the errors okay so here we're moving to uh some sort of boundaries right so x and y boundaries"
2755600,2767520," and then we're printing um a certain thing that is easy chat what the buffer uh put cells right so buffer put cells"
2769680,2778800," and um so what was the signature so x and y we already have a x and y in fact uh we just have to use"
2778800,2785840," boundary x and boundary y d y uh can you see by the way i think i think it's kind of difficult for you to"
2785840,2795360," see um yeah but maybe i should just make my stuff a little bit smaller all right so we put the cell then we"
2795360,2804560," have to put the line um and the line that we've got what is the line so we iterating the items of a chat"
2804560,2810640," log and what are the items of the chat log they are strings unfortunately so that means we need to"
2810640,2820400," convert them to characters nonetheless uh all right so let's do line charts because why not which is kind of"
2820400,2827360," dumb but maybe we're gonna make it a little bit better later all right so this is gonna be the line"
2827360,2836240," charts uh collect right so here's the line charts and in here so we might as well"
2836240,2844560," we might as well just do it like that so now we have to use line charts instead"
2846560,2853120," uh-huh that's a good one i think that's a good one i'd like to maybe like separate that a little"
2853120,2857920," bit can you see that i think i think it's kind of difficult to see but yeah i think it's more or"
2857920,2863360," less visible so and then we have to provide the color so when we provide the color so the first one"
2863360,2870080," is a foreground color right and for the foreground color we do have the color in here and the background"
2870640,2877280," is basically black all right so it has to be black so and we replace these two lines with this single"
2877280,2886640," huge ass ugly line uh which is great i really like that uh so let's take a look at the errors and okay"
2886640,2891520," so it only complains in the place where we call to this entire thing so now we have to just replace it"
2891520,2896480," with the buffer uh and this compiles apparently it's that easy"
2896480,2908720," okay so why is it so easy excuse me uh right so okay um yeah well already like all the status"
2908720,2914960," bar are rendered in the buffer client is rendered in the buffer so that's basically it so the last thing we"
2914960,2923680," render in here is the prompt which is rather interesting right because why does why prompt"
2923680,2928960," doesn't have its own rendering code that's kind of bizarre in my opinion you know what um i think"
2928960,2935600," i'm gonna continue with the prompt after a small break because um i've been already streaming for like one"
2935600,2943200," hour uh right so i ran out of tea i need to refill my tea and um you know once i finally have tea again"
2943200,2949680," i'll continue slapping the code so um so i what i want you to do i want you to actually factor out"
2949680,2954960," the rendering of prompt to a separate like a render function if you know what i mean right"
2954960,2965040," so separate a render function uh so in here prompt um how do we even render the prompt so status bar we"
2965040,2972960," always like uh we provide the width and height so yeah so i do have a prompt somewhere here"
2972960,2980320," so here it is so here is the prompt and it does a lot of things in here right so uh primarily controls"
2980320,2985600," and stuff like that uh but we want to be able to just render this entire thing so we're going to accept"
2985600,2995440," the mutable self and uh what i'm going to do i'm going to simply uh move this entire stuff to there"
2995440,3002320," right so this is going to be client uh the prompt is not located within the client so what i have to do here"
3002320,3008720," is just prompt render uh all right so then i'm going to go to render a copy paste everything in here"
3008720,3014480," so i'm going to uh call the compiler just to see what exactly do i have to provide in there"
3014480,3021360," uh right so exactly what they have yeah do i have to provide in there so uh here i'm going to replace"
3021360,3031840," studio out with qc uh right and qc is going to be just uh you know a mutable reference to the implementation of cueable"
3031840,3039360," uh cue cueable yeah cueable command right so that's what it is uh right so let's go to the compilation"
3039360,3046160," errors we'll also have to provide width and height uh so it's going to be use size like so"
3047760,3059120," um so i'm not quite sure so height this is more of a uh actually position right so this is more of a"
3059120,3069920," position i suppose um so we have to provide x and y and uh like where the prompt starts and we have to"
3069920,3077360," provide the the width how wide it is right so how wide it is so that's the only things we need in here"
3077360,3088560," um okay and this one is rather interesting so we have to move to x and y right so as u16"
3090800,3101840," uh as u16 and um so what else do we have in here uh so prompt this is actually self right so this is"
3101840,3107440," actually self what else do we have in here and the prompt is the buffer this is actually self so within"
3107440,3113680," the prompt we actually store the vector of characters which is correct right so it is in fact correct"
3113680,3124720," uh i'm not quite sure why do i do w minus two in here it doesn't make much sense to me maybe uh"
3124720,3132320," it's a room basically a leftover from some sort of like um cosmetic decoration from left and right when"
3132320,3139120," i was trying to put a frame in there and i just forgot to remove that that's what it feels like right"
3139120,3144720," because i didn't think i didn't think it's relevant right now right so i didn't think it's a thing that i"
3144720,3153360," should be worried about so yeah that uh and that's basically it so what else do we have in here so clear"
3153360,3159600," is unused all that stuff is unused okay so in this thing may actually fail all right and if i take a"
3159600,3168240," look at how other fn renders work we do return io result in here so that's fine um right so where is"
3168240,3175920," the other fn results so we're gonna do it like that so here everything is fine and if we reach this"
3175920,3183040," specific place uh that means no error has happened that's totally a fine uh okay so in here"
3183040,3189440," what we have to provide uh we have to provide std uh stdio we have to provide the position and the"
3189440,3196560," position was what uh i think it was zero h minus one or maybe h minus e i think it's h minus one and"
3196560,3203040," in terms of width it's the full width so that's basically it if i'm not mistaken i think that is"
3203040,3212000," basically it hopefully uh right so and that's the last error we have in here so all of that stuff is uh has to be"
3212000,3222320," be a use size so let's actually explicitly say uh as use size so let me put it in here and it compiles"
3222320,3228400," my phone so and by the way i should probably also put a question mark in here right so we're gonna put"
3228400,3236160," question mark in here and everything seems to be fine okay so i factored out the um you know all of that"
3236160,3241120," stuff into separate functions so now i can migrate this function to actually accept the buffer instead of"
3241120,3248160," queueable command right so uh let me actually see uh where is that thing so this is going to be buffer"
3248160,3252880," so it's kind of a weird way of doing that i could have like right away rewrite it but i don't know i"
3252880,3258320," felt like first factoring it out and then migrating it to a different mechanism i don't know if i made a"
3258320,3266240," mistake in here but i mean who cares um okay so what are we doing here so we're basically trying to"
3266240,3279600," yeah we might as well just take this right and collect that into like a characters right not really because"
3279600,3289200," we're taking a slice which kind of works out so that means we can buffer put chars put cells i would even say"
3289200,3298080," put cells and put cells accepts x and y and uh yeah so then the characters so the x and y is going to be like this"
3298080,3305120," the characters is going to be just that because it's already a slice we don't have to do shedding here which is super nice"
3305120,3309760," so the foreground is going to be white and the background is going to be black so that is basically"
3309760,3319120," it actually so this could be just a single uh line just a single line surprisingly it's not going to"
3319120,3326640," return any io errors in fact after we migrated to just buffers no io errors while rendering are going to"
3326640,3332800," happen because what we're doing we're just placing characters into the memory no actual io is happening"
3332800,3338880," io is going to be hap is going to be happening at the end of the iteration uh right when we actually"
3338880,3345520," computed the div between the buffers and we prepared the patch and then we're applying the patch this is"
3345520,3350800," where io errors will happen so we might as well get rid of all these io errors within the renderers"
3350800,3356160," all the render functions uh okay so let's go to the computation errors uh what else do we have in here"
3356640,3368080," so uh yeah so we have to now uh accept the buffer uh okay and it seems to be working but we don't"
3368080,3377200," really know if it's going to work or not or whatever okay so we are rendering the entire frame into a"
3377200,3383280," separate buffer it is not particularly useful right so we can print whatever is located within the buffer so"
3383280,3392000," maybe that is going to be useful uh all right so okay which is understandable yeah so there's nothing"
3392000,3399120," in the prompt there's nothing in the chat so because of that we don't see anything except the status bars"
3399120,3406800," anything except the status bar we can try one of the things we can try actually uh we can try to do chat"
3408800,3414720," maybe let's do chat error right so there's going to be chat error um client"
3414720,3423280," uh chat is that how we access it yeah so client chat you have to provide the mutable and uh we can put"
3423280,3431520," something like hello in here and that should add uh like five red characters to the whole frame right so"
3431520,3441760," that's what that's going to happen um right and here yeah so uh just a second so here's the hello right"
3441760,3450160," h h e l l o and the foreground for them as you can see is in fact red the background is black but it's red"
3450160,3456960," so this is what we have in that sort of back buffer that we didn't really realize on the screen or didn't"
3456960,3463840," actually render right so this is like actual like cells and its coordinates its styles and stuff like that"
3463840,3472240," so that's what we have in here um this is basically the virtual dome right so this is the virtual dome basically"
3472240,3483680," so um what we need to do uh we need to be able to maybe have actually two buffers right so essentially one buffer"
3484720,3492480," is the current one and another one is the previous one right so uh yeah we need two of them in fact"
3492480,3502880," right so it's going to be um um car buffer car and buffer previous so and to keep things shorter i think"
3502880,3508720," i'm going to actually call them buff car and buff previous so what we're rendering we're rendering"
3508720,3514160," everything into the current buffer right we're rendering everything into the current buffer so"
3514160,3520080," let me go to the completion errors uh right because that should create the compilation errors uh but yeah"
3520080,3528880," so if we're resizing we have to resize both of the buffers so that's interesting um okay so buff current"
3528880,3536560," and buff previous right so we're resizing both of them what else do we have in here so yeah i might as well"
3536560,3547040," i'll just query replace all of these things uh with buff car uh core there we go so do we have any other"
3547040,3556960," things in here uh so yeah we might as well queer replace that with just that"
3559200,3564160," it's basically that's a good analogy actually yeah it's basically like a double buffering"
3564160,3571760," but isn't virtual dome in react also kind of like a double buffering isn't it well it's not really"
3571760,3576720," double buffering yeah because we're not going to be swapping the buffers we're going to be computing"
3576720,3583600," the diff between the buffers and apply only the diff so it's really closer to virtual dome rather than double"
3583600,3594080," buffering so yeah so i don't think it's really a double buffering it's more like a virtual dome"
3594080,3607760," uh so interestingly um we need to we need to extend the buffer we kind of need to extend the buffer so maybe we"
3607760,3619440," could introduce something like diff right so it's going to accept self and um something like other"
3619440,3626400," which is the pointer to self right so the other buffer and we'll probably return you like a vector of"
3626400,3632400," patches right so some sort of a vector of patches and what's going to be the patch that's a very interesting"
3632400,3644480," question so patch um is essentially like a cell plus its coordinates right so we can say cell uh and then"
3644480,3653280," x and y right so basically it says you have to replace that uh like at that coordinates put this specific cell"
3653280,3656080," so i think that makes sense actually"
3659360,3670080," um yeah so and we just need to do that um so we may assert uh something for instance that self"
3670080,3676800," width is equal to other widths right so we want to make sure that their shapes are the same right so"
3676800,3683840," that's quite important i think uh shapes have to be the same let's actually combine all these things"
3685200,3698160," um yeah so that's what we assert uh afterwards afterwards afterwards i'm not sure right so maybe"
3698160,3707840," patch has to be a flat index can we just make it a flat index or maybe because it's it's obviously way easier"
3707840,3718240," to have something like n which is the self uh cells count and just iterate uh like this just iterate"
3718240,3725600," like this and basically just use i without converting to coordinates and stuff like that though converting"
3725600,3732640," to the coordinates is not that hard as we know right so you can just do it like that and there you go"
3732640,3737040," i don't know i already converted everything i don't even have to think about it so maybe i should have"
3737040,3746000," just done it like that and i already did in fact right uh so yeah so here is the x and y"
3746000,3759440," and uh essentially what we can say if the um self cells i not equal other cells i we just added to the patch"
3760480,3772560," just added to the patch just added to the patch maybe we can even go full comp soary and zip together"
3772560,3779840," all that stuff oh it has zip oh my god"
3784720,3788800," true comb soil language i swear to god it does it literally has a zip"
3788800,3799200," uh wannabe haskell wannabe haskell okay so what we can do we can just take a self"
3799200,3811920," cells eater and other cells um yeah zip it with uh so into iterators so we might as well just maybe then"
3812720,3820960," take it take it like that uh zip other cells so we've got we zipped those mother flippers together"
3820960,3830960," and now what we have to do we have to filter them right uh so and here we are going to have um"
3830960,3840480," basically a and b right so this is a and b um so these are the cells if we are"
3841520,3848640," filtering them only if they're not equal to each other right so filter the ones that are not equal"
3848640,3856000," to each other so this is the ones that we're interested in um but we need to have coordinates"
3856000,3861520," right so we need to have coordinates so we need to enumerate them uh right so we have to enumerate them"
3861520,3868560," after we enumerated them uh after we enumerated them we need to map them uh so we then we can convert"
3869120,3877520," to like x and y and stuff like that so and essentially so here is the enumerator and then we"
3877520,3888640," have a and b though the only thing we're interested in is the b right so we're not interested in a we're"
3888640,3895680," not interested in a it's only interested in b so here is going to be the patch so we might as well just do the cell"
3895680,3903760," uh then we can quite easily convert this entire stuff to uh just this so this is going to be cell"
3903760,3920960," x and y and we've got the patch so then after that we can collect uh this entire thing into effect"
3920960,3932720," all of the comp size are coming right now i'm not even sure if it compiles but we'll see we'll see"
3932720,3935440," so obviously we'll need to implement the equal and on the quality"
3937360,3945600," and stuff like that so all the comp size are coming"
3945600,3956080," yeah that's basically how you program in hascom right look man no loops yeah exactly"
3956080,3965520," uh no loops so let's see if it compiles or not i'm very sure it's something it doesn't compile um so zip is"
3965520,3971280," not an entity okay so you probably we'll probably want to do something like this so that's what you want"
3971280,3980240," uh into it i really wanted to actually avoid that so it wants me to do it like that"
3980240,3991280," um and you mean i also have to do it like that it's kind of dumb honestly it's kind of dumb but yeah okay"
3992480,4001040," so this is a cell cell um so i wonder if i can just do something like that can i quickly"
4001040,4011200," uh yep so it's not applied so we need a partial equality for this cell right so where is the"
4011200,4020320," structure cell uh let's make it partial equality right uh do we need anything else do we need anything else"
4020320,4029840," uh-huh i see what's going on uh-huh so it wants to yeah so it's also powder match it like that"
4031760,4040480," okay okay so what else do we have in here cannot move out of the shared uh okay well we can clone"
4040480,4048240," the cell i don't mind that though maybe making the cell copyable is even better who freaking knows"
4048240,4054480," who freaking knows um so something cannot move out of the shirt"
4056080,4061280," uh i just realized that i don't understand what the it wants for me so maybe"
4061280,4062960," we could have just done something like this"
4062960,4066800," because um"
4066800,4075040," maybe because we use self in here but it would have told me that right so it would have told me that"
4075040,4080400," uh i cannot move out of the shared move occurs because these variables have"
4080400,4082880," types that don't implement the copy trade"
4082880,4093360," but then it doesn't okay so i i've managed to crack the puzzle i cracked the puzzle"
4093360,4101200," crack the puzzle that's what i wanted to say the the vowels in english are hard honestly like"
4101200,4108400," so many vowels why do you need so many vowels english people like it's just like why"
4110400,4119680," uh so hard honestly uh yeah so that's that's basically the patch right"
4119680,4126240," and uh how are we going to be applying over there that's a very interesting thing"
4126240,4135280," so after we rendered everything right so after we rendered everything so obviously"
4136160,4144880," we yeah here's an interesting funny thing we clean everything in here and we move uh i think i need"
4144880,4157840," to move this kind of stuff closer to here right so so we clear everything i think the buffer needs to"
4157840,4163680," have a way to clean the entire screen um i'm pretty sure it needs to have something like that so let's"
4163680,4172480," actually do buff car clear all right buff car clear and clear i suppose is going to fill everything with a"
4172480,4179360," space right so that's basically my idea right so implement buff uh and"
4179360,4189280," so this is the diff uh a fan clear so i'm going to be taking multiple self and can you just take self"
4189280,4194320," cells and fill everything with cells and fill everything with cell space is that something"
4194320,4207200," that is feasible in a roost it is in fact uh buff car clear it is actually feasible so okay uh what"
4207200,4215040," we need to do now what we need to do we need to take the previous buffer and find the diff between the current one"
4215040,4221680," and that gives us the uh sequence of patches right so it gives us the sequence of patches right so it gives"
4221680,4225280," us the sequence of patches that we can try to iterate so this is the patch"
4226720,4234080," um so we might as well even do something like patch so here's the cell x and y so we extracted the cell x and"
4234080,4242880," y uh and essential we have to do in here we have to move to x and y right so this is where we actually"
4242880,4254880," perform the io uh io stuff um so we move to x and y and we need to just print with style right so i think i"
4254880,4262240," already removed the code that does that print uh right print styled content"
4262240,4266480," all right"
4266480,4271920," so that's another thing that we need to put in there"
4273440,4285440," uh so with so we need to take uh the cell ch right so this is the thing right uh might as well by the"
4285440,4299360," way uh pattern match it even further cell ch fgbg right ch fgbg so with the foreground color and um so let me"
4299360,4308720," just just double check i need to probably do cargo uh cargo dogs right so i need to have some dogs in here"
4308720,4309440," okay"
4309440,4317360," styled content so i want to take a look at the methods in here uh so"
4317360,4325440," with and the background is on okay so you provide foreground with with and background with on"
4327360,4334400," so yeah that's how we do that so ch with fg on bg"
4334400,4344160," there we go so and we're going to do uh std out q we are q in that specific thing right so we print it"
4344160,4351200," like that um and afterwards we just need to flush this entire stuff right so we're just flushing it we're"
4351200,4356880," simply flushing it so i suppose we don't really need to break anything in here so yeah"
4356880,4368080," that's pretty cool uh and i suppose now um after we computed the difference between the current and"
4368080,4373920," some other buffer we need to essentially swap them if you know what i mean right so we need to swap them"
4377120,4387440," though it's not as easy as it may sound right so we can just do the copy though we can just do the copy"
4389840,4397120," is there something for vector copy is there something you can do in here so there's a mem copy but it's"
4397120,4408320," probably unsafe uh no it's not really huh it's a nightly freaking rust anything anything useful isn't"
4409680,4421360," is in nightly so yeah i guess we can just do the clone all right so we can always do buffer uh previous"
4421360,4428960," is basically buffer uh current and just clone it and leave it as it is it's kind of slow but i mean who cares"
4430240,4438880," who actually cares so one of the things we probably want to do by the way is um clean the entire screen"
4438880,4448080," right before rendering anything right so we just do std out queue and then we want to do one single flush"
4448080,4450400," right so we want to do one single flush"
4452480,4462800," it's just doing one single flush and we probably yeah so that way the previous buffer is synchronized"
4462800,4468400," with what is actually on the screen right it is synchronized with what is actually on the screen"
4468400,4471280," so that's pretty cool um"
4471280,4480880," that is very very cool so let me try to compile the entire thing and go to the compilation errors so what's"
4480880,4488000," going on here uh well parsing the fields uh that's really bizarre oh yeah so that means i have to do"
4488000,4494880," something like this yeah that's true uh what else do we have in here print is not used so we have a"
4494880,4500720," bunch of unused things but i'm not really interested in those uh what i'm interested is these things right"
4500720,4510800," so as u16 uh might as well as u16 as u16 i wonder if i can power match them like this"
4510800,4517360," if this is if this is something that rust allows you to do uh expect it yeah you can't just easily do"
4517360,4524800," that but i mean we can just move it in here we can just move it in here so errors"
4524800,4529920," uh u u64 u16 that's what it means"
4529920,4540160," uh is that it no i didn't believe that uh and of course we have these things in here"
4540720,4549360," so buffer is not clonable okay that's not a big deal let's make it clonable"
4549360,4560000," cool so we have some unused stuff so this is not interesting this one is interesting"
4560000,4566160," all right um so when i put the cells i thought that i'm gonna have this kind of problems okay"
4569680,4575440," it doesn't have to be mutable yeah so we may actually call it something like start"
4575440,4580960," yeah so this is something like start and this is more like an offset"
4580960,4584800," all right so start and offset"
4584800,4594560," uh and yeah there we go so do i want to remove nah i'm gonna keep the warnings because i'm not sure if i"
4594560,4599600," want to keep this kind of stuff uh or maybe i'm gonna use them in the future"
4599600,4609360," yeah it's kind of interesting so what if you have a streak of patches with the same background in the same foreground"
4611200,4618960," you probably want to basically set the background and just print the things and then when the background"
4618960,4626000," or changes like set it to something else that's a very interesting idea actually yeah so that way"
4626720,4628160," maybe it's going to be more efficient"
4628160,4640560," so how many years i need to learn programming to be so fluent in it like you i've been programming"
4640560,4647120," personally for 18 years already so so i started the program to program when i was 16"
4647920,4660480," so it's 2006 right so to 2023 uh right so yeah so 18 years at least right so at least 18 years"
4660480,4668400," so if you don't have this much experience don't be too harsh on yourself"
4668960,4676240," maybe after 18 years you're going to be even more fluent than me but to be fair being fluent whatever"
4676240,4682800," that means if you mean like typing code quickly it's not really that important right"
4682800,4691280," so it's not really that important uh it's not how quickly you type the code it's if you type the correct code"
4692160,4700240," right so um essentially if you know what to type you can type it very slowly"
4700240,4704800," and you can be more efficient than the person who doesn't know what to type but types very fast"
4704800,4709920," so it's not about you know being fluid or anything that"
4709920,4721920," all right so uh let's actually try to run the uh the client and see if it does anything right so"
4722160,4727360," we're gonna do client uh that's actually kind of funny um because"
4727360,4731280," well i mean it kind of it kind of works yeah"
4731280,4742000," it kind of works it puts something on the screen right i'll give you that it puts something on the"
4742000,4750320," screen but i think it just ignores x completely um yeah which is kind of funny all right why did it"
4750320,4761440," ignore x completely so is that because we just um i don't know why because we're setting the cursor"
4761440,4767760," right then we're printing with a specific style uh though the style is kind of a it's kind of weird"
4767760,4776960," right so here for example it is black but maybe the color has to be a reset right so for instance"
4778320,4786480," yeah if i take a look at the chat error if i take a look at the chat error so we set this thing but"
4786480,4796640," when we render the chat so here's the chat log and as a background i set black maybe i should set the"
4796640,4803600," reset i remember there was a reset color or something or like a black yeah so there was a blank color so as"
4803600,4810160," you can see there is like a harsh black in the background of hello right so don't mind that"
4810160,4815280," it renders everything completely incorrectly but the color itself it kind of indicates that i'm just"
4815280,4821520," using the background coloring correctly so what i'm thinking is that now it is going to do that more"
4821520,4829920," correctly no it didn't actually surprisingly so maybe that doesn't really matter okay"
4829920,4841200," so i do not quite understand what's up with the coordinates maybe we compute the coordinates incorrectly"
4841200,4847680," so that could be the case so when we compute in the div right so when we compute in the div maybe"
4847680,4856320," that's the problem somewhere here yeah it is you know why we enumerate after we filter out things"
4858080,4864560," i mean i mean really so yeah"
4864560,4871760," uh yes yes yes so it has to be more like this"
4871760,4879360," so we're gonna try to rebuild this entire thing and uh if i try to do that that looks a little bit better"
4881040,4886160," that looks a little bit better it's kind of interesting that it has this sort of like a trail"
4886160,4891200," and everything by the way i can finally select it"
4891200,4896960," i can finally select because if nothing changes it doesn't redraw anything"
4896960,4901520," so let me show you something interesting let me show you something interesting i'm going to stash"
4901520,4910000," everything i developed today i'm going to run it one more time uh right so i couldn't select like you see"
4910000,4917120," i'm dragging around i couldn't select yes like i mean you can kind of see that it like blinks with"
4917120,4928640," selection but i can't select guess why for the same reason uh for the same reason um the the windows is"
4928640,4936000," flickering the windows is flickering literally for the same reason uh so but since linux is uh like a"
4936000,4941840," professional operating system with a higher frame rate that this operating system for video games uh"
4941840,4946880," you can't see the flickering you can't see the flickering because obviously like linux is faster"
4946880,4955680," uh so but you still cannot select but now since we're not redrawing like 60 frames per seconds"
4955680,4963520," uh it is actually allows us to select things which is which is kind of cool right so so let's do that"
4963520,4970240," so a visible result like actually visible result i think it's kind of cool right so now i should be"
4970240,4978720," able to select hello right and i can probably even uh what's funny is that i selected it and it doesn't even"
4978720,4986080," disturb the selection because it doesn't modify it it may disturb the selection when it starts to wrap around"
4986080,4989760," ah look at that it doesn't even disturb that that's actually super cool"
4989760,4994560," and this is probably because we don't even clear anything"
4994560,5002000," this is so cool so there is still this kind of thing i don't quite understand so there's something about"
5003120,5012880," there's something about how we use the the background color though rendering this thing as you can see"
5012880,5017600," doesn't create this weird trail of the background color"
5017600,5029120," so yeah that is kind of bizarre mine that is kind of bizarre but uh what i can do for sure i can probably"
5029120,5035440," finally delete this to do so because that to do is basically done that to do is basically done"
5035440,5045280," uh so and by the way i think we need to move the cursor after uh yeah yeah so after we rendered"
5045280,5052400," everything i think that's kind of kind of important so uh we rendered everything we moved to the cursor where"
5052400,5057920," it's supposed to be where it's supposed to stay in the flush then we swap the buffers we wait a little"
5057920,5070160," bit um right and everything is gucci everything is tamaguchi so everything is tamaguchi uh so i let me see how"
5070160,5082320," now we render the uh the prompt we just set the background to black and that is it and i can't"
5082320,5091200," understand why the it is like that uh let me try to run this thing one more time and let me oh"
5093760,5101120," it doesn't have that stuff anymore oh am i going crazy i think i think i'm going crazy so if i"
5101120,5109280," say there's no this is a known command so there's something um so i suppose what i"
5109280,5112960," have to do here is just use the reset so the reset actually worked"
5115280,5127120," yeah okay so i think i figured out almost though almost though so that means a fence space"
5127120,5130240," reset"
5130240,5141680," and i wonder if i can use reset for the for the foreground as well that's a very interesting"
5141680,5145120," thing can i use reset for the foreground as well i think i should be able to"
5145120,5154400," i can i think maybe it doesn't matter but i mean yeah"
5154400,5166800," okay and everything seems to be working so yeah now we're not um refreshing on each individual frame"
5167840,5175200," now we're keeping track of the state of the entire screen in a shadow in a virtual buffer"
5175200,5181440," just like virtual dome we're computing the differences we're computing the differences and we're applying"
5181440,5188000," only the differences we're applying only the differences and this is very freaking important my friend"
5191040,5197760," virtual buffer virtual buffer virtual buffer indeed that's what it is so i want to try this idea where"
5197760,5205200," we are not using print styled content but we're actually using set background color and essentially"
5205200,5212640," if you have a streak with the same style do not reset the style over and over again only set it once"
5212640,5218640," i think this is actually quite the case isn't it i think it is quite the case because for example when"
5218640,5222640," we're rendering the status bar right when we render the status bar you can clearly see that"
5222640,5229600," we set the style once and then we have this like a streak so we want to only set like style once"
5229600,5234160," um until the end of that streak so i think that kind of makes sense"
5235520,5242480," uh so yeah let me see if we can pull that off let me see if we can pull that off"
5242480,5251840," we may want to maybe keep track of this style somehow right so we can say"
5253760,5264240," uh fg current which is going to be color reset right so and bg current color reset and we might as well"
5264240,5267680," just set them all std out q"
5267680,5278960," um set foreground uh fg current and of course they have to be mutable because we can modify them"
5280000,5292400," uh set uh background bg current okay so we just set them essentially uh we move into x and y"
5292400,5302480," and one of the things we want to do if fg current not equal to fg right it's not equal to fg"
5303200,5313280," we set fg current to a new one uh right and literally set it like that and we repeat that"
5313280,5318160," for the background as well um i think that's a good idea that's an interesting idea actually"
5318160,5324160," i'm not sure if it affects anything maybe it's not really that important so and because of that we don't"
5324160,5331840," really need to have like a print style we can just print that character like this and that's basically it"
5333200,5336640," um"
5336640,5343200," all right so what is it complain out because of the parenthesis of course this is the most important"
5343200,5351040," thing for uh roosters is to never use this parenthesis that's the most important warning for them"
5351040,5354320," uh okay so let me see"
5357680,5365600," all right all right that didn't work uh that didn't work because i'm a dummy dum-dum"
5365600,5380560," okay boom first try that that was first try that was first try okay again um so interestingly"
5382560,5383120," enough"
5383120,5383120," enough"
5383120,5388240," uh can you try resizing okay that's a good good idea"
5388240,5395600," good enough"
5395600,5403120," uh we can just clear them all i mean uh it's not that big of a deal"
5403120,5408000," uh when we resize we can just clear them all"
5409520,5417280," um i mean we can probably clear them inside of the resize who said we can't do that i think we can"
5417280,5421760," self cells feel"
5421760,5424160," cell"
5424160,5431120," space it's not really like a space anymore maybe it has to be like a default"
5432240,5442320," um yeah maybe we can also close it yeah whatever uh doesn't matter don't want to ratful about it too much"
5442320,5444640," okay"
5444640,5448480," so"
5448480,5451920," it doesn't help"
5451920,5457840," because i was hoping that it's going to like literally reset everything but"
5458640,5465840," yeah so i suppose we also need to clean the uh clear the actual thing"
5465840,5470000," so let's do it like that so if you resize"
5470000,5473840," uh not like this this size"
5473840,5478880," i'm also going to do something like that"
5482000,5485600," and i don't want to print anything okay"
5485600,5498080," just uh clear just clear"
5498080,5509920," make sense to me make sense to me uh that's pretty pogue in my opinion so is there anything else that is"
5509920,5513440," left in here uh so here is an interesting thing"
5513440,5517920," we can also keep track of the current x"
5517920,5519840," current x"
5519840,5523600," so if the and if the x"
5523600,5529680," the current x is basically previous x but plus one"
5529680,5533200," we don't do any move in here"
5534560,5539040," you know what i'm talking about so essentially if you're rendering consequent"
5539040,5544640," uh cells on the same row there's no kind of any point in moving anything"
5544640,5552960," because you you just place one character and that's it i think it would make sense"
5552960,5555920," right i think it would make sense maybe we could also keep track of the"
5556640,5564160," uh you know previous um you know x previous all right so this is x previous"
5564160,5570560," and uh y previous also zero and essentially if"
5570560,5575520," y previous equal to y"
5577360,5586320," and um x previous plus one equal to x there's no need to set anything so it's kind of like we have"
5586320,5593680," to do the opposite right if it's not that only then we are queuing that stuff we can apply the morgan"
5593680,5601680," law right so uh essentially we can get rid of that negative if this thing not equal to that or"
5601680,5607440," that thing not equal to that and completely get rid of that but i don't think it became readable"
5607440,5613840," um quite often when you apply the morgan law it becomes less readable at least to my taste"
5613840,5621920," right i i prefer not to apply the morgan law in here we're not optimizing circuits right that's not"
5621920,5628160," what we're doing in here um right so we're not optimizing circus to trying to get it to a very"
5628160,5634800," specific set of elements we're just trying to write a readable code and i think yeah speaking of"
5634800,5641840," readability anyway so right because you have an action you have a condition and you just negate that"
5641840,5651200," condition right and you want to keep it that way right because that's straightforward um so anyways i"
5651200,5665200," wonder if it's going to work so and essentially um at the end um we will need to yeah we can do x"
5665200,5673920," previous equal to x and uh y previous equal to y so maybe that reduces the amount of actions you have to"
5673920,5680480," make and let me see if it's uh actually changing anything uh it's kind of it's kind of working"
5680480,5689840," maybe it's even maybe it's even faster who knows uh we can try to see how it plays out with the server"
5690400,5697920," right we can see how it plays out with the server so i'm going to put it in here um i'm just thinking"
5697920,5703520," yeah so the server is going to be down there right so the server is going to be down there and can i just"
5703520,5709200," run the server so here is the server and the client we're going to have two clients in here so the left"
5709200,5718320," client and the right client um so let me maybe open the token so it's easier for me to copy paste it like so"
5718320,5725440," and uh i'm starting the client and i'm going to be starting another client and i'm connecting"
5725440,5734480," to 927001 with the token there we go hi okay so let's connect to another one i'm connecting to 927001"
5734480,5743360," another token uh hi and it update it updates as i receive messages right so even though it doesn't"
5743360,5750000," update all the time it updates as i receive messages so which which is actually kind of cool"
5750960,5758480," uh right so i mean there's a rate limit and stuff like that but yeah so and i can select things right"
5758480,5768000," so it doesn't refresh anything so that's pretty poggers right um i wonder if that fixes everything"
5768000,5776480," on windows unfortunately i don't have a windows but i can commit uh i can commit the changes right now and"
5776480,5782800," if we have any windows users right in the chat uh you can guys tell me if it actually fixes anything"
5782800,5788000," you can find the source code in here and i'm about to commit some changes so might as well first"
5788000,5794720," maybe get rid of the unused things so we don't really have to reset colors or anything like that"
5794720,5800320," uh right so we got rid of all of the warnings right so we got rid of all the warnings"
5800960,5813840," uh implement uh virtual dome for terminals uh right so i just push that uh so do we have any epic windows"
5813840,5821840," users in the chat please confirm that there is no flickering that it works fine uh maybe we could do a"
5821840,5830800," ddos session how about some epic a ddos session so the last time not that many people joined the ddos session"
5830800,5837040," so the hypothesis why you know that many people joined is because um because of the bug and we"
5837040,5845360," have a lot of gamers in here apparently or because people didn't know how to use it right so just in"
5845360,5851920," case of the uh you know letter um so i'm going to show how to use the client so you do cargo run"
5852560,5861920," dash dash dash bin client right so that that's how you do that then you put slash connect there is a"
5861920,5869120," little bit of a tab out of completion right so you do slash connect uh ip the ip is available in a secrets"
5869120,5876800," channel on the discord right so uh right there we go so we have a discord thingy and uh so there's a"
5876800,5883280," a secret channel if you can't see that channel in the discord you're not supposed to people who are"
5883280,5890160," supposed to see that channel they see that channel right so namely uh specifically uh the subs right"
5890160,5896720," so you have to subscribe to be able to see that channel so uh right so the ip is gonna be available in"
5896720,5901600," here right so ip is not a secret by the way so that's why i'm showing it and also there will be a"
5901600,5906640," token so in essentially you provide the ip and you provide the token right so the token that i will"
5906640,5913120," provide and you just connect right so you just connect like that so that's how it works essentially"
5913120,5919520," if anyone was interested right um okay so all the changes are pushed all the changes are available"
5919520,5928320," so i think the term has come to try to deploy that to your mom all right so let's go to tmux"
5928320,5934320," uh i didn't think uh i didn't make any changes to the server so that should be fine so but i'm gonna uh"
5934320,5939600," fetch the changes uh just in case uh origin there we go"
5939600,5948880," so git merge origin uh main git merge origin main so let's do cargo build"
5950960,5952640," let's do cargo build"
5952640,5961840," there's no more flickering oh okay so there's no flickering list but the resizing makes every cell"
5961840,5967600," white okay so let me actually see what's going on uh copy link just a second"
5967600,5972080," so don't resize them i suppose"
5974960,5976960," oh okay that's very interesting"
5976960,5989040," that is very interesting that is very interesting i suppose the reset color on uh"
5989040,5994480," windows is not the same as on as on linux right"
5996240,6001440," uh it's not the same all right so that's kind of funny actually that's kind of funny"
6001440,6008160," all right uh but uh maybe we don't even have to do those that right if we know that um"
6008160,6014560," well we can do that anyway okay so i promised the epic do those sessions so let's actually do that"
6016080,6028720," uh all right so i'm gonna try to connect as well so how many people we have so hi it's me zozin"
6028720,6040240," so we need a way to actually tell how many people we have in there in in the chat right so my backspace"
6040240,6046000," is mapped to h instead of backspace okay that's that's kind of funny at least two all right so"
6046080,6051440," uh people are sending things so that's that's cool"
6051440,6060560," okay so this is the uh this stuff uh what's all with the empty mess messages so essentially the"
6060560,6065760," server sends a new line even though it shouldn't do that but it's just like an artifact from the"
6065760,6071760," previous version of the protocol so i will fix that at some point so that should be fine"
6073440,6080960," all right so um windows users say that everything works fine right so the only problem is that when"
6080960,6086720," you resize there is like a white white cells and stuff like that but this is because i"
6086720,6093120," uh i suppose the color reset on windows is completely different right so the color reset is completely"
6093120,6100560," different um so and but i'll look into that already after the stream i think right so i'll look into that"
6100560,6107840," already after the stream so we already did the main sort of chunk of the work we implemented the virtual"
6107840,6115200," dome if you know what i mean right so we implemented the virtual dome and uh right so all the like other"
6115200,6123840," bugs can be fixed separately um all right so and we actually did that in two hours surprisingly right so we"
6123840,6129120," did that in two hours that's actually pretty cool uh i didn't expect that it's gonna be that easier right"
6129120,6136800," so it's pretty straightforward then yeah so and it's not even that much code it's not even that much code"
6136800,6144320," so it's actually um you you could have actually included that in the cross term in the first place to be fair"
6145200,6151520," right even though cross cross term trying to be we are low level library we're not supposed to be"
6151520,6158080," concerned with this kind of stuff it's it's not that much code right we can even try to see how much code is"
6158080,6168400," that uh right so uh so where is my diff uh where is my different from it virtual from this for templates so okay"
6169040,6174560," so okay first of all you need to have the cell right so uh an implementation and stuff like that"
6174560,6177120," and then the buffer um right"
6177120,6186160," and that is it basically right so first of all the buffer okay um and all of that computes the um"
6186160,6193760," the patch to apply to the terminal and stuff like that uh right so you have uh 80 lines of code"
6194400,6200400," just for the buffer implementation just for the virtual dome implementation uh right and then you"
6200400,6207200," have the application of the patch right so the application of the diff and that is around um"
6207200,6216000," you know 20 one-handed lines of code right the feature that is only for the high level libraries"
6216000,6220720," one-handed lines of code like i mean come on you could have just edit that but"
6222240,6230960," rest developers rest developers all right i guess that's it for the day thanks everyone who's"
6230960,6236160," watching me right now i really appreciate that uh have a good one and see you all on the next"
6236160,6242800," recreational programming session with a mr azuzin i love you"

start,end,text
80,5920," looks like we're live hello everyone and welcome to yet another recreational programming session"
5920,10160," with the mr zozin let's make a little bit announcement and officially start the stream"
10160,19280," uh red car uh live on twitch and what are we doing today on twitch adult a television website"
19280,26960," today we are uh speeding up some right i'm gonna give you a link to where we're doing all that uh"
26960,33040," http as twitch.tv/cerning and i'm gonna ping everyone who's interested in being pinged and"
33040,38800," go the stream has officially started the stream has officially started so on the previous stream"
38800,47280," we implemented a seam carving algorithm which enables you to do uh you know content aware resizing and"
47280,53200," stuff like that so this is sort of like a meme uh application for this algorithm because it works so"
53200,62400," bad and faces the main um the main purpose of that algorithm is in fact uh to scale things like this"
62400,68480," right so for instance i want to actually make this image narrower uh without disturbing neither the"
68480,76000," person nor the building so i can make a i can use a content aware algorithm to do that so let me actually"
76000,82400," click we try to try to do that so here's the image uh and i'm gonna do output png it's probably gonna take"
82400,89840," some time and that's the main basically problem with this algorithm as you can see uh it is goddamn slow"
89840,97120," right so let's wait until it finishes and we'll see the result hello hello everyone welcome welcome welcome"
97120,107040," how are you guys are doing uh so yes it's getting faster actually i suppose because the image becomes"
107040,111120," smaller so it's kind of getting this is very interesting actually i never thought about it"
111120,117840," uh yeah there we go so and uh again the original image looked like this and our goal was to make it"
117840,124960," narrower so now it looks like this actually it's too narrow but what was funny is that it even carved"
124960,132000," a little bit out of the building to actually fit the person actually it's kind of funny how it like sort"
132000,138720," of like follows the silhouette of a person a little bit kind of uh right so but but that's basically what"
138720,145600," the content aware algorithm like resizing is right so it's aware of the content automatically uh right"
145600,153680," and it just like realigns the objects i suppose right so that's what it is and uh like there is a couple"
153680,161280," of low hanging fruits in the whole implementation that i did which will help us to speed it up a little bit"
161280,168400," ideally i think the performance of the algorithm should be fast enough so we can resize things in real time"
168720,174320," right because in the original paper uh right so let me actually see if i can find the original paper"
174320,178800," uh yeah okay so here's the original paper i'm gonna put it in in the chat and also it's gonna be in the"
178800,189040," description uh right so speed speeding up some sheets uh right so they demonstrated the algorithm"
189680,202800," resizing images in real time on 2005 computer with windows xp right so yeah imagine like 20 years ago"
202800,211360," it was already possible to do this algorithm in real time uh right so and this is a 10 years old laptop so"
211360,216240," definitely it should be possible in 10 years of laptop but we'll see we'll see maybe we'll not have"
216240,221520," enough time to actually do that to actually do the real time thing on today's stream but at least i"
221520,227920," want to not use a very naive approach anymore right so because there are some things to that can be"
227920,233760," easily improved in that algorithm already so and that's going to be the topic for today's stream right"
233760,241200," speeding up some shit speeding up some shit so let's take a look at some uh stuff oh my god that's"
241200,246640," that's that's a huge text so team scar thank you so much for twitch prime with the message hi mr zos"
246640,254560," i'm going to use my sub to suggest a stream idea using you all i like with a ray leap why because it"
254560,262080," would give the same deep inside as apl while being plain old unicode that gets formatted by the compiler"
262080,268960," into the symbols it has an ffi so ready is the uh is the picture and it can do things like threads file"
268960,275360," systems networking one interesting insight for the example would be that oh my god any output or a"
275360,282480," can be magically recognized the sound pictures or gifs just suggesting that's all i have no idea what"
282480,291040," what that is let me actually google that so the the language is my favorite programming language"
291040,305360," uh all right so what jesus christ okay uh so sum length divide okay so i suppose you're kind of pushing this"
305360,314880," list on onto this thing so let's actually see uh all right so it's four you sum up uh"
314880,322400," okay i guess i will take a look at this language but but but i won't promise anything honestly i won't"
322400,329760," promise anything we'll see we'll see um so yeah brooklyn dev thank you so much for twitch prime with the message"
329760,334000," keep up the awesome streams thanks mel you're welcome you're welcome i'm just like checking"
334000,340160," things that i find interesting uh valini thank you so much for tier one with the message speeding up some"
340160,346400," scheisse that's right my new friend uh jason rose fuzz thank you so much for your once a question with"
346400,352400," the message love these topics uh thank you right now people suggesting them on discord actually uh so i"
352400,357040," picked the ones that i personally find interesting sandy x thank you so much for tier one with the message"
357040,364000," speeding up some omg he's gonna cmd the algorithm honestly i'm not gonna cmd the algorithm because"
364000,370560," it's kind of uh pointless with modern compilers because they will cmd the for you automatically"
370560,375440," anyway right so there's the uh optim kind of optimizations that compilers do these days which"
375440,381040," is called vectorization uh so they can do that automatically you don't really have to do that manually"
381040,386800," so what i'm going to be doing is rather restructuring the code so it doesn't do things that"
386800,393840," are unnecessary right so i'm going to do something that the compilers cannot do automatically"
393840,398240," uh right so that's what i'm going to be doing whether it's going to be asymptotic optimization"
398240,403360," i think it's going to be asymptotic optimization right right so i think there's we could do some"
403360,408640," asymptotic improvements on the algorithm right so it's not going to be like this kind of stuff right"
408640,426080," because that can be delegated to the compiler so yeah yes so we have some interesting question in the chat"
426080,433600," hi it's sodium when i cut for several hours my eyes start getting dry there's a very easy solution just look at"
433600,440640," your issue tracker and you will instantly cry and that will help with the dryness of your eyes so that's"
440640,450000," how i personally do that uh so it helps it actually works um so let's go and just like take a look at"
450000,454640," what we can do with these shots so there's also pull requests in here which i probably won't accept"
454640,461600," let me actually take a look at that uh so uh use original sim value during loop i already looked into"
461600,466000," this pull request and it kind of makes sense so i'm probably gonna just accept this thing"
467440,475280," uh and yeah so i think i did a little bit of a fucky walkie as i was recovering the seam yeah yeah yeah"
475280,482320," so let's actually take a look at this entire thing so seam carving uh to be fair at that stream i was"
482320,490960," extremely sleepy again it is a miracle that i managed to implement something right so it is absolutely"
490960,496640," freaking miracle i didn't expect that i will manage to implement anything honestly uh so the fact that it"
496640,502560," has a little bit of a box it's fine right so we can just like iron out the kinks uh you know and stuff"
502560,510160," like that so what are we doing here uh so here we sort of did the dp already i suppose yeah so here we"
510160,517760," did already the dp then we start looking at the bottom of the image trying to find the smallest seam"
517760,524480," which is understandable right so this is the smallest seam and as we go to each individual row what we're"
524480,536880," doing is that yeah so we are imagine that we are essentially uh somewhere in here right so we are at"
536880,544400," a particular row and we're currently looking at this specific sort of pixel uh maybe i'm gonna even do"
544400,550240," something like that so we're looking at this specific pixel and what we need to do actually as we climb up"
550880,556720," uh right we need to look at these things uh right we need to look at these things and pick the column"
556720,565440," that is the smallest among these three and we are collecting that results into the seam so and then we're"
565440,572800," since we're using that original seam to pinpoint this location we're kind of moving it and it keeps drifting"
572800,583280," around and this is such a subtle bug that was not really obvious because i suppose on average it was"
583280,589680," okay yeah i think on average it was okay in fact here's an interesting thing here's an interesting"
589680,595280," stuff we can use for optimization in the original wikipedia article they said that you don't really have to"
595280,607120," use even dp they say that greedy algorithm works so a greedy algorithm would be not computing the dp table"
607120,613680," and like traverse and everything but just using the result of the sobel filter directly just always"
613680,619040," pick the one that is the smallest so that that's going to be the greedy one uh right so we're looking up"
619040,626560," who's the has the smallest energy so we go there it's not going to be globally optimal path but it's"
626560,632480," going to be sort of locally one and they say that it also works it works a little bit worse but it works"
632480,639840," and it's faster so because the greedy approach works i think that's why this bug stayed unnoticed"
639840,647120," right so so thank you so much whoever actually uh submitted the fix uh so uh i'm going to actually"
647120,656480," accept that thank you thank you thank you so oh thank you so much for catching this"
656480,665440," right so i'm going to just merge that uh right into the repo right into the repo so essentially the idea"
665440,671280," is to basically like pin the original sim so we're saving the original sim in here"
671280,677760," and as we are computing the next sim yeah we're always doing the original the way of setting from"
677760,682320," the original one so yeah that's that's a good solution i think that's a good solution thank you thank you so"
682320,693200," much um so you see i'm not outright rejecting everyone's pull requests i merge them sometimes right so"
695200,705120," uh so that video where i was actually reviewing pull requests on in zozylib.js uh so many people"
705120,710400," got really angry not so many people but some people got really angry that i was rejecting some pull"
710400,715040," requests without writing a wall of text of justification of why i rejected the pull request"
715040,722320," the reality is i get way too many pull requests to actually give this much attention to each individual one"
722960,733040," i'm sorry i'm sorry i'm doing that for free or literally so yeah as i don't freaking know um anyways"
733040,739120," i don't really owe anything to anybody uh so let's go ahead and just fetch the things"
739120,748480," avoided book backdoors what if this pull request actually introduced some back doors you know is there any"
748480,753600," scroll to the right no there is no any scrolling right maybe some kind of a trick would be to put"
753600,761600," some code somewhere far in the right uh right so you you will notice and then just merge it i wonder if"
761600,768400," it's possible to do on github it's really interesting anyways so let's actually merge that and uh let me"
768400,777040," actually try to run this entire thing and see if it um you know fixes some bugs maybe that bugs of carving the"
777040,784240," side side of the building was caused by that not because the person was too close but because that"
784240,789520," bug it's very interesting i never thought about it let me see it my team"
789520,798160," should have asked chat gpt to ask a wall of rejection text god damn it yeah"
799040,804160," probably the funny thing about like using chat gpt to generate these"
804160,810160," bullshit responses and stuff like that is that people just use chat gpt then to get the summary"
810160,817600," of bullshit responses and it's just like it adds this intermediate like useless oh oh"
817600,836560," all right all right so um no it still actually carves this thing around uh i think it even carves even"
836560,845600," more so yeah i don't know uh i didn't i don't think it actually changed anything that much we can also take a look at"
845600,851280," we can also take a look at the lena all right so does the lena change the shape of the face"
851280,856320," uh if we do it like that so let me readjust the camera"
856320,862640," uh super quick so lena is a little bit faster because it's a smaller image"
862640,868320," uh now it's pretty much the same uh yeah it's pretty much the same i suppose yeah"
869040,875440," so anyways uh what we can do to actually speed it up a little bit maybe it would make sense to"
875440,883200," um essentially measure the performance every time we run this entire thing right so because here we're"
883200,888000," just compiling this entire stuff and then we're running the application so it would make sense to"
888000,894640," uh you know actually measure some performance so let me see uh there was something like clock get time if"
894640,903200," i'm not mistaken right so there's a clock get uh yeah so here it is clock get time so let's quickly do that"
903200,911360," uh it will make it unbuildable unbuildable on windows but i mean who uses windows in 2024 right"
912560,918560," uh so let's actually you know create some sort of a wrapper function called get time uh right and"
918560,926720," essentially what it will do uh it will just get the time so we need to have a monotonic clock"
926720,935440," uh right so monotonic clock and here we'll have to maybe allocate this thing on the stack let's go ahead"
935440,942800," and allocate this entire stuff on the stack and take a pointer of the center i think so i suppose um so"
942800,950160," the only reason why it will error out is because i didn't have a permission to get the time so which"
950160,957920," means that um i suppose it will never like fail right so an error yeah so on success it's actually"
957920,963520," zero so we're gonna just automatically expect it to always be zero we expect it to just have a look you"
963520,972080," know an access to getting the uh to getting the clock so and after that so the time spec if i'm not"
972080,982880," mistaken chats uh time spec what are the fields of the time spec in here uh i don't see the definition of"
982880,990560," this goddamn freaking thing where is the definition brother uh is it defined somewhere else i'm freaking"
990560,1000240," you can remember um so there's probably yeah there's this thing uh anytime spec here it is so we have tvsec"
1000240,1012240," and tvnsec all right so that means we can do tvsec and so this is nanoseconds right so it's nanoseconds which"
1012240,1025120," means that we probably want to um basically divide this entire thing by nine zeros one two three one two"
1025120,1036080," three so we're just doing that uh which is doesn't make any sense i suppose yeah it doesn't make any sense"
1036880,1045440," so essentially we need to take this thing uh and add sex right obviously we probably want to uh"
1045440,1053200," convert it to double plus this thing multiplied by one two three one two three one two three something"
1053200,1059280," like that i suppose that's what needs to be done in here uh i think we might as well actually don't"
1059280,1064000," cast anything because this will this thing will automatically turn it into double and then that"
1064000,1069200," thing will automatically turn into the double and it's going to return the double in here okay anyway"
1069200,1078240," uh so what we want to do we want to take the double uh begin get time uh and uh we can now print something"
1078240,1091280," like no block uh nob info uh so resizing took uh this amount of sex right this amount of seconds and this"
1091280,1096560," is going to be essentially get time minus the begin and there we go that's how we're going to quickly"
1096560,1105920," measure the performance uh hopefully that will work that will work um so yeah it took four sex"
1106800,1111600," which is nice we can take a bigger image right so that one so i suppose that will take like maybe"
1111600,1116560," 20 seconds or something like that but but i want to see the amount of seconds so we can actually measure"
1116560,1128720," the improvements of our optimizations i wanted to use time command because a time command will include"
1128720,1137760," also compilation"
1137760,1143760," no dumping every iteration to a std art should also speed that thing a bit very very much it's"
1143760,1144960," it's not going to be noticeable"
1144960,1151280," it's not a low hanging fruit honestly it's not going to change that much"
1153840,1160240," because they're not printing that at a very high speed anyway so just like why"
1160240,1168800," if it was like a lot of text at very very high speed then maybe this is a small amount of text"
1168800,1176320," thousands of lines thousands of lines and look very very slowly it does nothing actually took a minute"
1176320,1183200," that's pretty surprising that's pretty surprising anyway so but i think we're going to use lena as"
1183200,1189520," the benchmark right so because it's faster and any improvements uh here are going to be noticeable anyway"
1189520,1196720," right so four seconds okay let's go into the um into the main application so the first thing"
1196720,1201360," by the way we can do is to not recompute luminance every iteration"
1201360,1215840," oh fuck anyways so what we got so here's the thing uh what we do with the luminance basically corresponds"
1215840,1224000," one to one to the pixels uh instead of recomputing the entire luminance over and over again we can just"
1224000,1232560," remove the same pixels in luminance as we do in the actual image and that way we do not recompute the"
1232560,1239600," entire image of of luminance so we just don't have to do that right we simply don't have to do that"
1239600,1246400," so uh let me let me see uh we can put the luminance in here uh right and we can just remove the columns"
1246400,1253760," along with the pixels in fact uh i feel like it would be nice to maybe move this operation to a separate"
1253760,1260240," function of some sort let me quickly do that i have an idea right i think it's even like these two uh"
1260240,1271360," two lines can be moved to a separate function uh so something like image remove remove column but we"
1271360,1279520," effectively removing the column at a particular row so i suppose it makes sense to even specify that we're"
1279520,1286560," removing column at a row uh and essentially here we're going to accept an image uh like so i don't"
1286560,1291360," think we have to accept it by a point all right so because we're only modifying the like the data"
1291360,1298080," not the structure itself and here we're going to accept uh the row uh at which we're removing the"
1298080,1306160," column and the column that we're trying to remove so this is a pixel row uh this is the row um so and"
1306160,1315600," sim is the column right so like this to this pixel row column and that's about it so this is sort of like"
1315600,1321760," a separate function which like tax away this thing that doesn't really make any sense into something"
1321760,1326480," that kind of does make sense right so it's more of a semantic operation if you know what i mean"
1326480,1336080," uh right so in here we can say okay so we're removing an image at a row y at a column which is"
1336080,1341600," the same and we don't have to do that anymore so the reason why i'm abstracting away this specific"
1341600,1347200," operation is because now i can have a similar one which does the same but for a matrix right because"
1347200,1356400," the luminance is a matrix uh right so we can do mat remove column at a row uh and here we can have"
1356400,1367040," mat mat int um row int column so and we can simply even copy paste this entire thing in here like so"
1368080,1376240," so the only thing we'll have to do we'll have to replace image with the mat like so and maybe even"
1376240,1383280," uh pixels we don't really refer to pixels directly yeah we do not refer to the pixels directly so but"
1383280,1390480," we do refer to the inner type so we'll have to replace this with floats i suppose right so essentially"
1390480,1399840," what i can do now uh i can do mat remove column and we're removing luminance at y sim and we're just"
1399840,1405840," repeating this entire thing here as well right so now we're not recomputing the luminance on each"
1405840,1412000," iteration the entirety of the luminance in each iteration but we just like remove it we update it and"
1412000,1416960," that way it should be faster so the previous thing was actually like four seconds so it doesn't even"
1416960,1427280," compile um so what's up with that expected something semicolon i see um did it become faster so there"
1427280,1433840," was a four seconds yeah it's still four seconds actually so it didn't really improve the thing that much"
1433840,1441760," surprisingly i don't know it's actually it actually improved it so it warmed up some caches"
1444400,1455280," hmm it in fact warmed up some caches that's pretty cool uh so three seven so we can try to repeat that"
1455280,1466880," several times um yeah 3.8 and stuff like that so if we kind of like stash this entire thing uh so let"
1466880,1477680," me commit uh let me commit uh the get time thing uh measure time of generation in knob and i'm going to"
1477680,1491440," actually push that right into the repo let me let me see so uh now i want to actually stash this entire thing"
1492160,1498240," and see if that makes it slow again if there's any performance improvement"
1498240,1507760," i think there is like it's five seconds now without that improvement that we did"
1507760,1511920," yeah i think i think there is definitely improvement"
1511920,1519680," yo that's a lot of actually improvement so i'm gonna like uh enable the optimization that we just did"
1520240,1530160," and so five six seconds uh and how about this one now it's four there is definitely an improvement holy"
1530160,1537840," shit okay so just not doing just doing less already improves the performance that's pretty cool so and"
1537840,1543920," we only improved like one step and let's actually see if it uh yeah so it's the same result right as"
1543920,1551280," expected uh so the next thing i suppose we need to do we need to not compute the entire sobel filter but"
1551280,1556960," the problem with the sobel filter is a little bit more subtle uh because pixels kind of depend on their"
1556960,1563120," neighbors right so that means we need to recompute more of the things actually we need to recompute more"
1564000,1570000," um so let's um so let's maybe experiment um so let's maybe experiment let's imagine that we have some sort"
1570000,1581360," of image in here uh right so in here is the sobel filter so if i remove this pixel somehow like i removed"
1581360,1589120," this pixel uh that means i need to recompute all of the pixels that dependent or then on on that pixel which"
1589120,1595440," means that uh it's uh it's all of these things right it's all of these things like around it"
1595440,1611120," uh like so so and if we imagine that sim goes like this right so along the entire sim along the entire sim"
1612000,1618640," i suppose i just need to recompute all the neighboring things so here uh it's gonna be something like that"
1618640,1627440," for this thing these neighboring things like so for this thing these neighboring things and for this thing"
1627440,1639680," these neighboring things um all right so that makes sense i suppose that makes sense uh though this one yeah"
1641520,1649040," so it it is it has to be like that uh so and if you remove each individual thing in here"
1649040,1657360," you basically need to recompute things along the sim right no"
1657360,1660240," yeah"
1660240,1670160," so i was thinking what's going to be the the best way to do that and obviously we need to only do that"
1671040,1679680," uh we need to only do that when we already removed the pixels"
1679680,1684960," right we only have to do that when we already remove the pixels"
1684960,1700560," so i'm kind of curious about this one this one looks weird but i guess it's all right that's basically"
1700560,1706640," what we have to do so we need to keep track of the things that we need to recompute how we're going"
1706640,1708640," to be keeping track of these things"
1711200,1718720," uh how are we going to be keeping track of these things maybe we could mark them somehow we could mark"
1718720,1719840," them with none"
1719840,1729040," or the sobel filter can a sobel filter be negative i feel like it cannot be negative maybe it could be"
1729040,1737120," negative actually right if i take a look at the sobel filter yeah so some of the things can be negative so"
1737120,1745760," it's not a particularly great thing um so i was thinking that maybe as we remove some things we just"
1745760,1756320," mark the pixels that needs recomputation um that needs recomputation with some sort of a special value"
1756320,1763760," right so that you cannot achieve and that value could be literally just some sort of a numb none some form of a none"
1763760,1773680," uh maybe even very very specific none all right so that it's obvious that that's the none we're we're doing"
1773680,1782480," um though you're gonna end up uh iterating the entirety of the thing anyway"
1784080,1790240," um so it would be better to maybe have some sort of a list but i'm really really not sure really really"
1790240,1797120," not sure so i'm gonna just keep it in here uh so but one of the things i probably want to do first of"
1797120,1804960," all uh is to maybe factor out the operation that does recomputation if you know what i mean so this one"
1807440,1818160," um the operation that does recomputation um so let's do sobel filter at uh like so"
1818160,1822800," and i want to take this entire thing"
1822800,1835520," uh and maybe factor out this stuff right in in all fairness maybe i'm gonna just return what the"
1835520,1843280," fuck just happened yeah i actually did this thing so float like this and grad okay so grad is only used"
1843280,1850560," in here so in effectively what we can do we can just return this thing uh all right and essentially"
1850560,1859360," instead of doing this entire thing we can just do sobel filter at uh sobel filter at so i don't really"
1859360,1866240," know what this function should accept uh the way i'm gonna figure it out uh is by basically uh rebooting"
1866240,1872080," this entire thing right so in complacent it wants cx uh which is understandable so i'm going to just"
1872080,1880800," provide cx uh cy and that's that's basically how it's going to be parameterized so and because these"
1880800,1888160," things are only used uh things are only used uh in here i can just move them in here right so which"
1888160,1894880," allows me to uh simplify this and test out so here we also accept the matrix all right so let's quickly"
1894880,1901680," go ahead and accept that matrix for which we're doing all that and uh here we have to specify the matrix"
1902240,1909680," c uh x c y okay so this is actually a pretty cool way to figure out what function should accept you want"
1909680,1916400," to like factor out some chunk of a code to a function just copy paste it there and try to compile and just"
1916400,1921440," follow the compilation errors and like it asks for these variables just pass those variables to"
1921440,1927280," to a function and you figure that out so it would be kind of nice to like allow the compiler to maybe in"
1927280,1932240," line this function if needed so let's actually mark it as static right so the thing about the"
1932240,1939200," the non-static function is that the compiler will think that somebody is going to use this function"
1939200,1944960," like outside and will prevent it from inlining to be fair what i've noticed is that quite often"
1944960,1951120," it's not a problem for a compiler right so the way the compiler works with the functions that are"
1951120,1956480," exported from the object so it has a version that is exported and then"
1957040,1962160," if it needs to align it so it just inlines the body of the function anyway right so it sort of"
1962160,1966480," like maintains two versions of the function so just because the function needs to be available"
1966480,1972000," outside of the object it doesn't mean that it's not going to be you know inlined but just saying"
1972000,1976560," that the function is not going to be visible outside of the object kind of helps with optimizations"
1976560,1980880," like generally so and maybe this is something that i want to actually go ahead and do"
1981440,1988000," just go through all of this function and say that they're like local internal to the object so you can"
1988000,1993680," do whatever the you want with them maybe even completely eliminate them right because we're not"
1993680,1999600," writing a library honestly we're not writing a library so maybe that will help the compiler to do the right"
1999600,2005280," thing uh right so i think it's a good idea to try that so"
2005280,2011680," yeah just do all of that mind if throwing to just do all that"
2011680,2017280," and all these things are very much in lineable actually if you think about that they're all very"
2017280,2022480," much in lineable all right let's go so and some of these things are not even used anymore right so"
2022480,2028800," maybe we don't even need them uh but we'll see we'll see so how's it going uh all right but it"
2028800,2035040," didn't really improve that much so we'll already say oh three uh so yeah it should already crank up"
2035040,2044560," all the optimizations like very high anyways uh so sobel filter at uh and so now so the the reason"
2044560,2049680," why i factored it out so i can actually use it outside of recomputing everything so if i want to"
2049680,2054960," recompute very specific pixel i can actually do that right so that that's kind of the point in"
2054960,2059680," here right so if i need to do that i can't actually do that um so yeah"
2059680,2072000," so yes so yes so thank you so much anonymous gifter for uh tier one sub i thank you i thank you i"
2072000,2083040," for giving the subs um so how are we going to be approaching all that so as i go up so we're going"
2083040,2094720," from the bottom to up essentially right so and when once i removed it i can't try to recompute this thing"
2094720,2103760," right away right so i can't do that yet um because maybe some things are going to be changed up above"
2103760,2110720," right so i really need to first remove all of that stuff and only then uh recompute all of those things"
2110720,2115360," uh but then how i'm going to"
2117760,2126560," actually approach that so i can maintain a list of the coordinates that i have to iterate through but"
2126560,2134560," how do i know how many coordinates i have in here so obviously i have uh five elements at the seam but i"
2134560,2140960," have way more of these things in here so it's not particularly obvious or straightforward to figure out"
2141760,2156880," right so this optimization is kind of it's kind of hard so another maybe um easier optimization right so"
2156880,2162320," maybe i'm going to actually put it aside uh maybe i'm going to just put it aside so another very easy"
2162320,2176400," optimization is to not use dp right so and um we can basically use the grad instead of dp and that will"
2176400,2188320," turn it into more of a like a greedy solution um what's funny is what's funny is the way we can just do dp"
2188320,2196480," is by replacing dp with grad which means this kind of thing becomes a parameter so we need to factor"
2196480,2205760," out uh we need to factor out this entire this entire function somehow so the question is how we're going"
2205760,2211680," to do that like the same way we usually do that right so let's actually go ahead and just like put this"
2211680,2221840," thing in here uh and let's say remove sim right so remove sim and now i'm going to just literally"
2221840,2228320," do something like this static void remove sim and we will figure out what this function should accept"
2228320,2234880," by following the compilation errors as usual as usual so what do we want so image okay so that"
2234880,2243920," means we have to pass an image in here um so yeah yeah that's cool so it's going to be image uh what's"
2243920,2249840," the other thing we have to pass in here uh dp and that's the thing that can be parameterized in here"
2249840,2257040," so and in fact i would like to maybe call dp something like map uh right so because instead of dp"
2257040,2261440," you can just use grad and it's going to be worse but it's going to be faster because we don't have to"
2261440,2271120," compute dp so let's replace dp with map uh like so right and what else do we have in here so luminance"
2271120,2280800," we also have to accept the luminance oh this is good map uh lume right there we go um so what's the"
2280800,2287440," order of those things uh and in here it's going to be like that so we pass the image pass the luminance"
2287440,2302800," and here we pass dp uh there we go uh all right all right all righty so three which is understandable"
2302800,2314080," so uh the idea is the idea is use grad instead of dp and don't recompute dp on each individual"
2314080,2320960," iteration just like simply don't do that uh so that is very much a greedy solution but because"
2320960,2326320," you eliminate the whole step in here it should be faster so let's actually see how much faster it will"
2326320,2338640," become um i didn't change anything that's surprising actually so that means maybe that was not the slowest"
2338640,2339120," solution"
2339120,2349440," i mean not the slowest step that is very fascinating it like didn't change anything so let's take a look at"
2349440,2354240," the result is it different yeah it is this is actually different"
2354240,2365520," this is so fucking cute oh this is so cute"
2370160,2381920," so i think you're finding the emacs terminal it doesn't even people what the fuck is wrong with"
2381920,2389440," you okay let's actually try to illuminate the this thing like it doesn't output that much text to actually"
2389440,2394720," for that thing to matter like i do not believe that it's going to be a significant improvement"
2398720,2405040," it's not it's not it's not even close to be significant improvement it's it's a little bit of a text"
2405040,2412240," at a very slow speed well i'm okay i'm gonna go like literally literally trolling me jesus christ"
2414640,2431760," uh so let me let me see uh all right so it's very interesting so just not doing dp all the time"
2431760,2440880," uh doesn't prove it so dp is actually very fast step so the main source of uh slowness is apparently is"
2440880,2446720," apparently coming from the sobel operator all right so that means that's the thing that we have to"
2446720,2452480," tackle in here um so and what's funny is that the sobel operator is actually very much parallelizable"
2452480,2457440," if you think about it yeah it is very much probably possible um"
2461200,2472000," mm-hmm so you know what i think i want to make a small break i think i want to make a small break"
2472000,2476560," and refill my cup of tea and i'm going to think how we're going to approach this entire stuff"
2476560,2484640," uh right so maybe we can try to parallelize that uh but even without the parallelization like the fact"
2484640,2491120," that you can only need to recompete like a certain amount of the kernels is actually very much low"
2491120,2498160," hanging fruit that we shouldn't ignore it's just like i'm not sure how like conveniently organize this"
2498160,2503760," entire thing right like i'm not sure how can we organize this entire thing for example if i'm iterating"
2503760,2511600," from down in here like okay i can add the coordinates of this thing in here which is fine right so i remove"
2511600,2521600," this thing but then um then like what do i add i also have to add this thing uh right i also have"
2521600,2528480," to add this thing but this thing got removed right so this thing marked this one asked to recompute but"
2528480,2536480," then on the next iteration it got removed so it just like looks a little bit weird though once as we"
2536480,2545600," remove this thing as we remove this thing we kind of know um what we're removing in here anyway so"
2545600,2554080," yeah we'll see we'll see okay so that's that's kind of uh that's kind of interesting so in any case um"
2554720,2564480," so the idea is to actually save this sim so it can be easily replayed later uh right so because"
2564480,2571840," to recompute the subtle filter i need to know the entirety of the sim already uh right so but i don't"
2571840,2579920," know the entirety of the sim as i basically recomputed so what i'm thinking is that um we need to pre-allocate"
2579920,2593520," some array uh of the height of the image so and in fact and in fact uh probably what we want to do we"
2593520,2601280," want to have like a array of sims right so let's call it sims right because the the word sim is already"
2601280,2608640," kind of taken but sims imply that we have several of them which is not like exactly what we have in here but"
2608640,2618320," anyway so size of sims like so multiplied by the height of the syntax stuff right so we have that"
2618320,2625920," and here we're removing the sims uh right but what effectively we're doing we're kind of recomputing"
2625920,2634720," um we're kind of recomputing this sim so what i'm thinking is we need to factor out the logic of"
2634720,2646640," computing this sim to a separate function so um you know compute uh this sim so here we accept the image"
2646640,2653600," so here's the image but maybe image doesn't really matter what we care about in here is actually the"
2653600,2662240," map right so we're doing that based on the map uh right and we're also going to accept these"
2662240,2670240," sims array that we're pre-allocated in there so the gist of this entire stuff is this thing so we're just"
2670240,2684480," computing the sim and the sim is located at actually uh the sim is located at y in here so what i'm thinking is"
2684480,2696080," maybe we could do something like sim y equal to zero sim y this is a very cool idea honestly"
2696080,2703600," right this is a very cool idea so that means instead of a single variable sim now we have an array of like"
2703600,2715840," variable sims um which is super cool um which is super cool so and then in here as we iterate this entire thing"
2715840,2723040," down um so we have the original sim"
2726480,2736080," which is not particularly in the original sim it's more like a y plus one right so it's more like a y plus one"
2736080,2745760," so we"
2745760,2745760," so we"
2745760,2749840," oh"
2749840,2753840," that is very freaking cool"
2755680,2765760," because now because now we can do sim y okay i see how we can do that so original sim is a y plus one"
2765760,2781360," yeah just a second uh sims y plus one just the sim is actually just y so there's a next and like a previous one"
2782720,2785440," um"
2785440,2793360," actually the other way around yeah actually the other way around and ironically just a second let me"
2793360,2799040," let me go back um so original sim is a sim it's the"
2799040,2802800," current one"
2802800,2810800," damn i'm not quite sure like it fucks up with my brain"
2811600,2813760," it really fucks up with my brain i can't"
2813760,2816560," comprehend this thing"
2816560,2819760," uh i'm trying to just like"
2819760,2822560," use it as this"
2822560,2828640," um what i'm thinking is that sims y now have to be"
2828640,2830000," sims"
2830000,2832080," y plus one"
2832080,2835360," right so that's sort of like the new thing"
2835360,2839440," um that's sort of like the new thing"
2841440,2846560," uh but then when we're doing that thing we're doing sims"
2846560,2848720," y plus one"
2848720,2852000," and this is going to be sims"
2852000,2853760," y"
2853760,2860400," sims y and i think i did the correct thing in here i think so"
2860400,2861520," um"
2861520,2863200," yeah"
2865600,2866640," mm-hmm"
2866640,2871200," yeah i think so"
2871200,2892080," cool so that way we're computing that sim so now when we are removing the sim and that's the cool part when we are removing the sim we don't really need to do that stuff because the sim is kind of pre-computed so we essentially can just like provide the sim in here right so this is the sims"
2892880,2894720," uh so which means"
2894720,2897440," uh so which means and i'm going to actually cross off this entire thing"
2897440,2900400," uh so we just iterate"
2900400,2901920," the y"
2901920,2904000," uh to"
2904000,2905600," something like image"
2905600,2906480," height"
2907280,2912560," and what's important in here is that all of these things they have the same size but i'm not sure if i"
2912560,2915680," like want to double check that for for so many things in here"
2915680,2920080," so and in here what we're doing is just that"
2920080,2923200," just that"
2923200,2925920," seems"
2927440,2932800," because we offloaded computing that sim to a completely separate function so we don't really"
2932800,2935840," have to do that in here we can just follow that sim"
2935840,2940400," and remove it so it's like we we split these two operations into separate parts"
2942160,2943360," um"
2943360,2946800," cassiancio thank you so much for which prime with the message always a pleasure listening"
2946800,2951920," your thoughts thank you i didn't expect that i'm just i thought i'm just like rumbling so"
2959280,2963600," for me one of the most enjoyable things in the stream is to follow those thoughts i'm not sure"
2963600,2970880," if i'm always capable of like exposing my thoughts my thoughts well enough for people to understand but"
2970880,2978080," i mean i'm glad that people like to follow them so let's uh replace emoji with map uh like so"
2978080,2988320," so we just do that uh cool cool cool and here by the way we don't even have to do that anymore"
2988320,2990240," all right so we can just do it like that"
2990240,2999040," uh all right so let me try to maybe um recompile this entire thing and see like follow"
2999040,3005120," the compilation errors instead so this is going to be sims y uh all right so what else do we have in"
3005120,3015200," here so this is more like sims uh what else do we have yeah sims uh yeah so when we're removing the"
3015200,3024800," sim well first thing we have to do we have to recompute uh or compute sim uh we're providing a map"
3024800,3030960," which in our case is dp uh all right and also provides the sims uh since we don't really plan"
3030960,3037920," to use grad because it's completely incorrect uh so i suppose instead of calling it a map we should"
3037920,3044000," just call it dp right so i wanted to call it map because i thought it's going to be customizable uh so"
3044000,3050880," let's just use dp instead and dp is not that slow of a step honestly right so just trying to eliminate dp"
3050880,3056240," actually didn't make it faster and it made it incorrect so i don't really care about this thing"
3056240,3065120," anymore then uh so compute the sim we provide dp and we just do that so on and so forth uh so then we"
3065120,3069760," don't even have to provide the grad because we already pre-computed the sims so this is basically"
3069760,3075920," what we're doing in here uh so right now i just want to check if it didn't break anything that's what i'm"
3075920,3081440," looking for so let's see if it didn't break anything hopefully it didn't okay it works all"
3081440,3087520," right so we didn't break anything so i managed to sort of separate the operation of computing the sim"
3087520,3093680," right and then removing the sim from the uh from the image and luminance and so on and so forth"
3094800,3099440," uh okay so that's what we're doing here we just removed the sim"
3099440,3110720," and interestingly now interestingly now"
3113920,3119600," um we kind of want to"
3119600,3130240," in the sobel operator right in the sobel operator um we want to"
3130240,3142240," kind of remove these things right uh let me actually just do it like that so this is the copy i don't want to"
3142240,3153920," lose that one right and then we have to kind of follow that sim again and we have to know"
3153920,3158480," that some of that stuff is going to be removed"
3165760,3174640," some of that stuff is going to be removed"
3174640,3191600," damn it's not really helping that much thinking like what's the best way to approach this entire thing"
3192240,3195200," let's just maybe have a completely separate map"
3195200,3204640," uh for which i can just like do it like that i don't know man like i thought i figured it out when"
3204640,3209920," i was making a break so that if i save the sim i can just backtrack it again"
3210880,3217840," uh but that doesn't really help that much honestly right because okay i'm backtracking this sim"
3217840,3227120," then i suppose i can okay so i removed this thing uh and i removed this thing so how did that help me"
3227120,3233840," that didn't really help me at all so that only made it more difficult the easiest way would be to maybe"
3235520,3243120," uh like again just mark all of them in a certain way with it like sort of like a nan value but then i"
3243120,3249280," have to iterate through this entire thing anyway so it doesn't really solve any problems per se"
3250640,3256640," but we can try to do that uh right because the competition of the single like a sobel filter"
3256640,3264000," thing all right it involves like security and shits right so maybe eliminating that security is going to"
3264000,3272560," make it faster um so yeah i'm not 100 sure so what kind of like a nan value we can pick"
3273200,3282480," uh what kind of nan value we can pick i wonder so what if i uh take something like this uh and i'm"
3282480,3290480," going to say it's going to be x and let's say it's going to be c c c c c c c c c right so is it a nan"
3290480,3298000," um i don't really know honestly so printf so let's actually print it so let's take a pointer at these"
3298000,3302960," things and then the float and then dereference this entire thing and let's just run it"
3303760,3312240," so is it a nan no it is not a nan so would be a good what would be a good nan honestly"
3312240,3319120," um so i don't remember how you construct a nan maybe something like"
3319120,3326160," um so everything f is a nan right it must be"
3328800,3335280," yeah okay so like everything f is a good nan i think right so minus nan um"
3335280,3337600," yeah that's pretty cool"
3337600,3341840," uh that's pretty cool that's pretty cool"
3345760,3355520," so as we uh removing the sim all right and to be fair removing the sim is such a primitive operation"
3355520,3359920," that i don't think it has to be a function so the the most complexity was in computing the sim"
3360640,3362880," right so that was the most of the complexity"
3362880,3370800," uh right remove sim remove the sim like they open the chat i don't know"
3373040,3377440," uh all right so that's pretty cool"
3377440,3380080," and now"
3380080,3389760," as i remove a particular sim right remove a particular sim i just need to mark"
3390960,3393120," those things in a certain way"
3393120,3401840," so how can i easily like construct this as a float"
3401840,3408320," all right so can i just i don't know"
3408320,3417280," is there any easy easy way to construct like this kind of none in a float way if you know what i mean"
3417920,3423120," or maybe it doesn't even matter right because one thing i can do when i'm accessing"
3423120,3427920," uh a particular field in here right so let's imagine that i do something like at"
3427920,3433280," then this is a grad and i took a specific value right so y and x"
3433280,3437040," i can always take a pointer of this thing and just like"
3437040,3443200," like cast it like this and then just assign this kind of thing"
3444960,3452320," and there you go i marked it and then later when i need to find that specific value i can always compare"
3452320,3458880," that to that okay so that way it may work actually right so that's uh that's an interesting way to mark"
3458880,3469840," it i suppose anyways uh so i need to do that square thingy uh that i already do in here right so that's"
3469840,3475840," definitely what i need to do so i might as well just copy paste this entire stuff right"
3475840,3482320," so i need to copy paste this entire thing"
3482320,3485600," and uh so cx"
3485600,3488880," is basically seems"
3488880,3492400," y and y is"
3493440,3498960," the y unfortunately so this y is already kind of taken so let's actually call it c y"
3498960,3505040," right so let's call it c y so and this is going to be c y so it's sort of like a center"
3505040,3513200," c y and that way i can just do something like like this we can even say that c x is in fact"
3514640,3518480," something like this in fact we can factor it out like that"
3518480,3524720," all right so it's c x now c y c x and this is kind of similar to what we have in here"
3524720,3528880," uh all right and so we also have this condition that checks for"
3528880,3535280," whether we are within the range of certain things right so that's a very important condition in my"
3535280,3544320," opinion and this is where we can mark mark the uh you know the grad uh so mat i think it first it"
3544320,3549440," accepts the row and column so it's going to be y and x so then i'm going to take the pointer to this"
3549440,3556960," entire thing and then the custom to that and then just do f f f f f f f f f f right so there we go so"
3556960,3568400," we mark this entire shift to be like that cool very very freaking cool uh so um all right so if"
3568400,3573680," we're not going to be recomputing the sobel operator all the time we we need to compute it only once"
3573680,3579760," right so here we computed it only once and then we're going to be patching it up so to speak if that"
3579760,3585200," makes any sense we're going to be patching it up um all right so we did that and then"
3586320,3597440," we need to essentially uh maybe even remove all of this stuff but i feel like the removing of the"
3597440,3606800," column for the grad has to happen after this entire thing so we kind of need to have the second iteration"
3606800,3616160," along the seam in here right the second iteration along the seam in here um right then"
3616160,3625520," we subtract this thing in here we need to patch them up right so then we need to patch patch them up"
3625520,3634160," uh so let me see let me find the sobel filter uh somewhere here so that's basically the iteration"
3634160,3642240," we do in here uh and the way we're going to do that right so we just iterated that stuff uh so this one"
3642240,3654960," one is going to be just a grud uh and so before to add um oh yeah so we definitely have to do the mat but"
3654960,3666400," this is going to be the luminance right so it's going to be the luminance mm-hmm so if uh this particular thing"
3667040,3674880," if this particular thing if we take a pointer of this thing and convert it to in 32 pointer and then"
3674880,3683760," we compare it to that stupid ffff whatever whatever all right so we have to recompute its value uh with"
3683760,3692720," this subtle filter so and the hope is effectively the hope is that um we're just not gonna do"
3692720,3698320," the very expensive security operation on each individual pixel in here and hopefully overall"
3698320,3704960," it's going to become faster if i didn't do much fucky walkiness in here right so maybe i'm actually"
3704960,3712080," fucked up something in this algorithm but i didn't think so i didn't really think so actually you know what's"
3712080,3717280," funny is that for this sort of like a symmetry maybe it makes sense to actually remove these things in"
3717280,3725920," here right so here we specifically just mark out the patches of the sobel filter that we need to"
3725920,3733040," recompute and then we remove all of the columns in here right then we remove the column and then we patch it up"
3733600,3747760," so we could actually um even make it cooler in the sense that we uh we know that when we removed the"
3747760,3754400," the seam where i already removed the comment with the sobel filter a seam and thing yeah whatever so let"
3754400,3761360," me put it somewhere here so let's imagine that we have this kind of yet again right so and the seam goes"
3761360,3767680," something like this right so i need i need this seam again right um"
3767680,3773040," something like this"
3773040,3782960," so this one yeah so it also takes that this is that this is that uh maybe maybe i need to actually do"
3782960,3792480," something like this so it's a little bit better like so so i know when when i remove the seam right when"
3792480,3800240," i remove the seam i know that the thing that i need that i need to patch up are like around the area where"
3800240,3808960," the seam was so maybe i can just still still follow the seam but i roughly know where i have to look"
3808960,3815200," here right like i roughly kind of have like know where all of that is so i don't have to iterate the"
3815200,3822400," entirety of the message so that could be another optimization in here right so we roughly kind of know"
3823280,3830720," where all of these patches are located roughly uh so to speak uh but anyway so let's actually see if"
3830720,3835680," this entire thing even compiles because who freaking knows it doesn't even compile look at that because"
3835680,3845040," let's see why uh what else do we have in here so this is a mat in here we in fact are iterating so in"
3845040,3851680," reality here what we're doing we're iterating actually grad so i would like to call this thing a grad"
3852240,3858400," so maybe that thing could be also factored out to a separate uh to a separate function right so"
3858400,3860880," we'll see how it goes"
3860880,3870880," c y c x uh and yeah so in this particular case c x is actually that all right okay let's see"
3870880,3880880," so yeah it is faster and if you take a look at that it didn't break"
3882240,3889040," is it not a poggers is it not a voggers my new friend so it's now so initially at the beginning"
3889040,3898080," of the stream it was actually six seconds now it's 1.7 1.7 very nice very nice indeed"
3898080,3904880," so because sqrt is a very expensive operation so we just like reduce the amount of sqts"
3904880,3907040," basically real time"
3908880,3914320," we just reduce the amount of square t's and uh it became faster and i'm basically eyeballing all of"
3914320,3918720," that right so i'm basically eyeballing all that i'm not doing like a proper profiling because"
3918720,3922320," i don't even know how to do the proper profiling um"
3922320,3931360," so the most the most bizarre thing about profiling especially if you're watching somebody like jonathan blow"
3933200,3940880," he would have like a very sophisticated precise setup to measure some sort of a performance"
3940880,3945360," right so it's very sophisticated very precise like a lot of different reports and stuff like that and"
3945360,3949040," he would pinpoint precisely what's wrong and stuff like that and then he would say"
3949040,3954720," yeah this is not the correct way of doing that i'm not really measuring the performance but i'm just"
3954720,3958960," like you know estimating and stuff like that so that's the most bizarre thing when you watch"
3958960,3964640," jonathan blow he's just like doing insane sqt and then he says that that's not the right way to do"
3964640,3970560," that like i'm not doing that properly because i'm i'm slacking today or something like that it's just like"
3970560,3979040," jesus it's just like it's kind of similar to watching like a like a professional artist who's"
3979040,3985120," just like drawing and masterpiece and say ah i just sketched out some ideas i'm gonna throw the way it's"
3985120,4003120," just like i just sketched out some idea um anyways um so again um what we uh can improve here again"
4003120,4010240," so we're still iterating the entire image to find these patches sort of speak right so we're still doing"
4010240,4018800," that um so that my idea would be to actually not iterate the entirety of the grad for for these patches"
4018800,4031200," so by the way uh i think i need to test that on the on the broadway thingy um because i want to see if"
4031200,4036960," it's like yeah so that one how much time this one took i don't remember honestly"
4036960,4046560," um but it's it's the long one it was one minute yeah yeah so it was one minute so how much time does"
4046560,4056240," it take now uh 17th was it really one minute 17 seconds look at that and"
4056240,4060320," yeah it's it's basically that right so"
4060320,4072880," so that's the that's the trick in optimizing your program just don't just don't do things that you"
4072880,4080800," don't need to do right so just don't do useless work essentially just don't do useless work just don't"
4080800,4090560," do useless work um so since we don't really have a single variable seam anymore i think it would make"
4090560,4098320," sense to rename word the seams to a seam right because that kind of bothers me so the only reason why"
4098320,4103840," i called seams is because i thought i'm gonna have the variable seam right so i don't really have that"
4103840,4110880," variable anymore so it's not really uh important to call it like that naming is the hardest part of"
4110880,4118560," programming am i right am i right fellow programmers is it relatable my fellow programmers naming the variables"
4118560,4130960," oh my face when i forget to put a semicolon programmer programmer am i right fellow programmers"
4130960,4136560," i'm so fucking sorry um um"
4139600,4149120," clone what's up what's up what's up what's up correct yeah that's what it feels like when i read"
4149120,4157520," programmer humor honestly it's just like it feels like a bunch of non-programmers just learned programming"
4157520,4165760," memes and just like you know trying to impress each other that's what it feels like it's just so weird to me"
4167920,4176320," um so six second 1.7 but people swear the problem is emac so yeah but what's interesting is that emacs"
4176320,4184400," io is i do agree with that but not in this case uh right not in this case students basically meaning"
4184400,4190720," yeah i just like people are trying to learn programming through memes what the is that"
4190720,4195440," but maybe maybe it will work who knows"
4195440,4199200," um back in my days"
4199200,4206000," back in my days when i i started to program in 2006"
4206000,4213680," and i remember quite vividly that at the time if you say that i want to be a programmer"
4214320,4222880," the reaction everyone's reaction literally would be in what a nerd in and it's just like it's so bizarre"
4222880,4227520," to me how everyone wants to be a programmer this day it's just like that's that's not the reality"
4227520,4233920," where i started programming that was freaking different uh most intended discussion seems mean"
4233920,4239680," meme directed yeah that's actually true that is actually true it's kind of difficult because maybe"
4239680,4246080," maybe because we have way too many people on the internet so uh it's sort of like the only way to"
4246080,4255200," communicate with like this amount of people is to through like sort of well-established patterns"
4255200,4259440," that people can instantly recognize or something like that it's such a bizarre"
4260240,4267600," um it's such a bizarre phenomenon that we never seen before right because we never had such"
4267600,4273360," informational systems before with this amount of information at such a high speed so it's sort of"
4273360,4277760," like a thing that we never experienced before programming discussion would probably be nicer if"
4277760,4284320," there was a less money to be oh that's for sure that's for sure so there's nothing wrong with money per"
4284320,4290000," se there's nothing wrong with money but the problem with money is that they usually attract the worst kind"
4290000,4296400," of people so that's the problem so money is not a problem money is good uh it's the kind of people"
4296400,4299120," that the money usually attract that's kind of the problem"
4299120,4310720," and people are too addicted to meme funny instead of uh posting something real yeah i also want everybody"
4310720,4325440," love small i can buy my tea on the money so uh how can we freaking fix this choice so essentially the idea"
4325440,4335680," we're already kind of iterating the same right but the idea would be to essentially"
4338960,4344720," not iterate the entirety of the role right so we're iterating rows right like that"
4344720,4351680," and then within the row we like iterating everything but we don't have to what we can do"
4351680,4364000," we can kind of roughly locate uh sim c y and this denotes the area within the row roughly where the"
4364000,4370960," patch is allocated so it points at the cluster of patches right and patch is basically a float with"
4370960,4378000," this sort of none right so that's what it is this is like the the first time ever in my life i like"
4378000,4384800," created this hack uh right which is a kind of cool trick honestly is that a very common thing in in"
4384800,4391200," programming uh right because that occurred to me only like right on the stream right is that a good idea"
4391200,4400320," even um so what i like about this thing is that it's none so it's obviously something off and i'm using"
4400320,4407520," something obviously off as a marker to recompute that value later and i kind of like this trick it's it's"
4407520,4416960," kind of cool uh i think um if it compiles equal idea good not necessarily not in the world of c where you"
4416960,4422000," have a ton of undefined behavior i'm not even sure if that's defined behavior i think like type punning"
4422000,4427760," is not a particularly defined behavior so the undefined behavior of behavior lawyers are gonna eat me alive"
4427760,4439120," uh using null for point is a similar idea probably yeah what's funny is that uh you can even use different"
4439120,4445840," kind of nones for denoting different kinds of things right so maybe four different values you have to use"
4445840,4451440," different functions to patch them properly so you can just have ff maybe another one is going to be"
4451440,4458240," something like a a ff and they will denote like different things uh right so who said you can do that so look at"
4458240,4466880," it's like a nan boxing so i just answered my question people do like that nan boxing is literally that"
4466880,4471920," isn't it it's just like it's a more advanced version of that you're not only just marking these things with"
4471920,4479360," none you store an entire freaking pointer instead of in inside the flow for new people on the channel"
4479360,4488160," have you guys heard about nan boxing uh right if you never heard about nan boxing you you never experienced"
4488160,4492800," life honestly uh right it's such a bizarre fucking concept um"
4495200,4510480," the bad one it's nan boxing uh nan boxing so okay the idea is essentially you literally store a pointer"
4510480,4518800," inside of float right that float is an incorrect float right that float is an incorrect float"
4519680,4529840," but inside of it there is a pointer so in the idea here is that yeah um it's used in scripting languages"
4529840,4535440," specifically in javascript it's very actively used in javascript so essentially a value you can"
4535440,4544080," denote a value within an interpreter as just a single float right just a single float and float inside of"
4544080,4552640," it stores a tag which denotes whether it's an integer a float or something else and that"
4552640,4557600," something else is usually a pointer that points to a bigger structure in the memory"
4557600,4567360," so that way uh right so again you can denote a c like value of any type within an interpreter as a single float"
4568160,4576640," uh right so and that's what nan boxing is that's what man boxing is um right so it's it's very useful when"
4576640,4585520," essentially your value within the inter interpreter must be of a certain size for example a size of"
4585520,4591200," float but i think in in case of non-boxing they use double right so 64 bits uh right"
4591200,4596800," that's very cool that's an interesting idea but the consequence of that idea is that"
4597840,4606640," because you're storing also a tag within the double you don't have all 64 bits of the pointer"
4606640,4615040," you don't have all 64 bits of the poor pointer so you have a limit on how much memory you can address"
4615040,4622000," using nan boxing but the amount of bits you have for the pointer i think it's 58 or something i think it's"
4622000,4629120," like around 58 or like i don't quite remember it's already like like enough more than enough it's not"
4629120,4636240," the 32 bits kind of situation where you can only address four gigabytes right you can address enormous"
4636240,4646480," amount of memory with like 58 bits but it's less than 64. um so using a float number to box and then yeah"
4647920,4659840," that's what you do anyways uh so the question is the question is if i just use cx so i'm probably if i'm"
4659840,4668560," using cx i'm probably pointing right at the cluster right so essentially we had this situation so this was"
4668560,4677200," this thing that we removed and i may have this kind of situation in here so i was pointing at that i"
4677200,4682400," removed that i'm now pointing and this so i'm quite likely pointing at one of these things so the only"
4682400,4688960," thing i need to do i need to move to the left and move to the right move to the left and move to the right"
4689680,4698800," so so but cx is not necessarily going to be a valid thing for example what if the seam a chunk of the"
4698800,4702720," seam was at the edge in here and then it got removed"
4702720,4711360," that index got invalidated completely so it got invalidated"
4714000,4723920," so what i'm thinking is what we have to do maybe we have to do two loops essentially we start from here"
4723920,4729760," and we do while cx is less than grad width right"
4729760,4739920," um something like that plus plus cx and we're moving to the right we're essentially moving to the right"
4740480,4749680," and honestly we can also do a very cool thing while it's less than grad width and it is the mark marker"
4749680,4756720," we can just do something like that right so we're starting from there and moving to"
4756720,4764080," to the right we can now try a similar thing we're starting from here and move to the left but since we"
4764080,4769360," already kind of handled whatever we had at the seam we probably want to do minus one"
4770160,4777680," while cx is greater or equal to the zero and we're subtracting this entire thing and then"
4777680,4785840," we're doing the same thing in here so we're not iterating the entire row we roughly estimating so"
4785840,4792320," at the seam we probably add the cluster of these patches and we're just moving to the right and to the"
4792320,4799920," left that way we're like yeah we don't do that many operations hopefully um so yeah"
4800160,4807680," let's see if it's going to improve the performance it's going to improve the performance"
4807680,4809600," it's going to even compile i'm not sure"
4811840,4819360," uh yeah it's improved it a little bit i suppose so yeah it is correct it's it's yeah so that that's"
4819360,4825280," the correct face i know it when i see it trust me chat this is the correct face"
4826240,4831520," uh it looks faster it was yeah so before it was 1.7 now it's 1.3"
4831520,4832960," um"
4832960,4841120," yeah so it's consistently 1.3 so we just do less operations in here we just simply do less"
4841120,4848960," operations uh right so what about the broadway tower so it was like 17 seconds"
4850080,4855680," uh all these things kind of end up and now maybe we can start actually getting rid of the output"
4855680,4871040," all right so it's 14. it was 17 now it's 14. okay so uh let's double check if it's a correct value"
4871040,4878960," yeah this is the correct thing okay that's cool so let's get rid of the output that everyone is so"
4878960,4880400," freaking crazy about"
4880400,4888560," so it was like how much"
4888560,4901840," it's still pretty slow i'm surprised why why can't it be when pasta is still 13 okay so that's fine"
4901840,4906240," that's fine though it's fine"
4908960,4913040," so it's pretty cool"
4913040,4919120," no in okay okay so"
4919120,4926560," we do the grad ndp so what if we now"
4926560,4929280," use the"
4929280,4936800," lazy approach anyways so let me just go ahead"
4936800,4944640," do that and simply uh commit whatever we have uh simply commit whatever we have"
4944640,4948880," hopefully i didn't make too many mistakes so if i made any mistakes this time feel free to submit"
4948880,4962480," the for request uh right try uh like speed up the um resizing by not doing things that are not needed"
4962480,4978160," so i removed the writing the dp image so i removed the writing the dp image i don't write the dp image so"
4978160,4991600," yeah so this entire thing expands to this stuff it expands to nothing it's disabled"
4991600,5003120," you do notice you didn't know right so uh yeah so this is a debug thing and i can actually enable it or disable it"
5003840,5008640," um to be fair to be fair to be fair it's not really neat anymore per se but i mean it's just there for"
5008640,5013360," whatever reason uh from the times when i was actually experimenting with all that anyways"
5013360,5019920," i want to kind of factor out uh some of that stuff um right"
5024000,5038000," so maybe how can we call that um compute um prepare or maybe mark out sobel patches"
5038000,5045440," i really like how this thing makes it sound like i'm doing something serious"
5046080,5053040," right oh yes mark out the the sobel patches right right so it's the the ones that i wrote in in that"
5053040,5058080," paper that i released last month the the sobel patches so"
5058080,5069200," uh all right chat chat do you know how to recompute the sobel patches"
5073680,5078000," all right all right so let's actually try to compile this into anything so we need to pass"
5078000,5087680," the grad and sim uh there we go to those we need in here um grad and sim let's go"
5095760,5104720," it's rebuilding stuff"
5104720,5114240," so it should be 17 seconds right no it's 14. okay so i want to try this idea yet again where we do not"
5114240,5125280," recompute the entirety of dp like at all um so where is dp oh dp is only needed like in here which is which is"
5125280,5133120," fine i guess so essentially just use grad instead of dp so that will turn the solution into"
5133120,5140560," a greedy one rather than like a dynamic programmer mode and let's just try to do that uh it feels like"
5140560,5145520," it's not going to improve the performance i feel like it's not going to perform the performance right"
5145520,5154160," oh it actually improved it to five seconds okay so but the result is probably going to suck yeah it"
5154160,5158880," actually sucks so greedy solution doesn't really doesn't really work that well huh"
5158880,5161520," it's so funny"
5161520,5170560," lena looks especially cute with the with the lazy solution uh i really like it actually let me show"
5170560,5174480," you how lena looks like uh so let's take a look at the performance"
5176640,5181360," um yeah look at the performance of the lena like half a second almost real time"
5181360,5189360," uh all right and it's just like this so cute it's shy very shy lena"
5193840,5204080," um it's not a good solution so you do need the dp you do need the dp"
5204080,5212640," interesting get it under 16 no second yeah that's probably something that i have to do"
5213200,5224080," um to be fair like in those demos in those demos people were using probably images with smaller"
5224080,5232320," resolution i remember they have an pretty crappy quality so yeah that's probably this is how they"
5232320,5239920," achieved the performance right so it wasn't like a pretty crappy um you know crappy resolution so if we're"
5239920,5248240," gonna be using like open mp or stuff like that how can we even do that can we i guess we can do a little"
5248240,5257280," bit of open mp on this kind of um on this kind of so open mp can be applied in here for sure"
5257280,5264880," it can be applied in here as well so i don't think i'm gonna apply anything before that loop right so like in"
5264880,5273600," here i don't think it matters uh but slapping open mp here and here might be beneficial um"
5273600,5282480," might be beneficial so yeah pragma omp parallel four yeah yeah so this one thank you so i'm gonna place"
5282480,5288880," this thing in here and also place this did you guys know that like the c compilers can do this kind of"
5288880,5298080," a shit so essentially uh in c compilers you can use this pragma and it will parallelize this for loop"
5298080,5306240," it will just split it into it like if you don't uh have like values that depend on each other it will"
5306240,5311760," just split it into chunks and run in separate threads so it's called open mp if you never heard"
5311760,5318480," about it it'll just google it up open mp it is a thing without an externally it will link with an"
5318480,5323440," external leap it will do that but i mean it's just like the it's usually shipped with like all the"
5323440,5328880," compilers uh but i'm not sure if it's going to actually improve the performance uh we'll see we'll see"
5328880,5337280," uh fork join model right so essentially you use your fork computation compute independent parts and then you"
5337280,5344480," join them right so basically like reducing or summing them up or something like that so yeah so you do"
5344480,5350720," like omp parallel but i mean we need to do four yeah parallel four and i don't remember you have to compile"
5350720,5356080," with a special flag or you don't have to compile with a special flag uh so let's just try to compile as"
5356080,5370000," as it is and see if it's going to yeah ignoring unknown for rams okay so um gcc gcc flag to enable open mp"
5370000,5381920," uh loop unrolling can help but i mean we already uh put o3 so i presume that it does loop unrolling"
5381920,5392000," already so to activate it for fortran i mean fortran uh okay so the open mp cmd flag can be used to"
5392000,5402880," enable subset of an implicit that do not uh all right so i don't know why it didn't work so it just says"
5402880,5412960," unknown parameter surprising maybe we should do clang instead let's let's give it a try so i already do"
5412960,5420000," cc so i have this thing actually look at that clang"
5420000,5423040," uh maybe"
5423040,5430960," include needed and flag i see so i need some sort of example so i think in wikipedia"
5431680,5441360," there was an example omp yeah there we go so does it have a flag uh f open okay i see i see ic ic pc"
5441360,5451280," so and then in knob let's go back to just cc and yeah"
5454240,5464240," uh f open and p right i feel like it's not gonna improve it that much i have a feeling i have a"
5464240,5469520," strange feeling that it's not gonna improve it that much maybe it's gonna even make it slower"
5469520,5477200," fuck i feel like it's gonna yeah it's yeah it's it's making it slow"
5479360,5487120," uh f open np and l omp but i mean it doesn't say that you have to do lmp yeah thread creation overhead"
5487120,5496400," thread creation overhead so that's the problem that's the problem anyways um so let me see we can try to"
5496400,5504720," link to link l omp let's see let's see yeah sometimes it's just like it is what it is"
5504720,5505600," when i find it"
5509600,5512480," oh so you don't really need this kind of stuff"
5512480,5522720," okay so let's not do open mp then but it was nice to try right so i rarely have an opportunity to"
5522720,5528640," use open mp right like for real so it was interesting maybe it will help in here but it didn't really"
5528640,5544640," help in here okay so is it compiling yeah so that's 1.2 you can tune out the number of threads with num"
5544640,5553120," threads so you can try to yeah whatever uh whatever whatever whatever whatever mark out sobel patches"
5553120,5571760," um all right so factor out this thing so all right let's compare the performance at the beginning of"
5571760,5579280," the stream uh so let's go here and let's just run lena so what's the performance of lena"
5583120,5588320," are you still in the greedy approach i didn't think so i think i switched back 5.6 seconds let's"
5588320,5590560," try it one more time just for a good measure"
5590560,5601040," you came up with the concept of sobel patches and that's powerful uh yeah i think it's that special"
5601040,5611120," of a thing uh there we go so so six seconds uh all right so let's go to the log and let's switch to"
5611120,5615280," the current thing and now let's run um"
5615280,5627680," and 1.3 all right so that's a good improvement and we can even compare right so visually they're"
5627680,5637360," indistinguishable so it's pretty cool it's pretty cool uh i guess that's it for today thanks everyone who's"
5637360,5641920," watching me right now i really appreciate it have a good one and i see you all on the next recreation"
5641920,5648400," programming session with mr azuzin uh i love you"
